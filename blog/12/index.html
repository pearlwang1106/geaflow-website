<!doctype html>
<html lang="en-US" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">GeaFlow图计算快速上手之K-hop算法 | GeaFlow</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kaiming-l.github.io/geaflow-website/blog/12"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="en-US"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en-US"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="GeaFlow图计算快速上手之K-hop算法 | GeaFlow"><meta data-rh="true" name="description" content="作者：范志东"><meta data-rh="true" property="og:description" content="作者：范志东"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-08-21T00:00:00.000Z"><link data-rh="true" rel="icon" href="/geaflow-website/img/favicon.png"><link data-rh="true" rel="canonical" href="https://kaiming-l.github.io/geaflow-website/blog/12"><link data-rh="true" rel="alternate" href="https://kaiming-l.github.io/geaflow-website/blog/12" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://kaiming-l.github.io/geaflow-website/zh-CN/blog/12" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://kaiming-l.github.io/geaflow-website/blog/12" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://HO4M21RAQI-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://kaiming-l.github.io/geaflow-website/blog/12","mainEntityOfPage":"https://kaiming-l.github.io/geaflow-website/blog/12","url":"https://kaiming-l.github.io/geaflow-website/blog/12","headline":"GeaFlow图计算快速上手之K-hop算法","name":"GeaFlow图计算快速上手之K-hop算法","description":"作者：范志东","datePublished":"2023-08-21T00:00:00.000Z","author":[],"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://kaiming-l.github.io/geaflow-website/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/geaflow-website/blog/rss.xml" title="GeaFlow RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/geaflow-website/blog/atom.xml" title="GeaFlow Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="GeaFlow" href="/geaflow-website/opensearch.xml">





<meta name="algolia-site-verification" content="4AB782AC2021573E">
<meta property="og:image" content="https://mdn.alipayobjects.com/huamei_tu4rvn/afts/img/A*PkdvSLd2A6kAAAAAQMAAAAgAep_eAQ/original"><link rel="stylesheet" href="/geaflow-website/assets/css/styles.b78ac409.css">
<script src="/geaflow-website/assets/js/runtime~main.5eef9370.js" defer="defer"></script>
<script src="/geaflow-website/assets/js/main.9dd247bd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/geaflow-website/img/logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/geaflow-website/"><div class="navbar__logo"><img src="/geaflow-website/img/logo.png" alt="GeaFlow Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/geaflow-website/img/logo.png" alt="GeaFlow Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="versionSelect_qA4O"><div class="versions_jk5T"><div class="selectItem_V7J8 selectItemActive_BNvF">0.0.2</div><div class="selectItem_V7J8">0.0.1</div></div><div class="current_ORt9">0.0.2</div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link header-locale-dropdown"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/geaflow-website/blog/12" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">English</a></li><li><a href="/geaflow-website/zh-CN/blog/12" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">简体中文</a></li></ul></div><a href="https://github.com/apache/geaflow" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_dCNk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="navbarCenter_ZzI1"> <a class="navbar__item navbar__link" id="docs" href="/geaflow-website/docs/guide">Docs</a><a class="navbar__item navbar__link" id="community" href="/geaflow-website/community/how_to_contribute">Community</a><a class="navbar__item navbar__link" href="/geaflow-website/download">Download</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/geaflow-website/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li><li><a href="https://www.apache.org/foundation/policies/conduct.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Code of Conduct</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/28">流图计算之增量match原理与应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/31">Graph4Stream：基于图的流计算加速</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/29">GeaFlow 时序能力探秘——让时间数据焕发新生！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/30">Join性能变革：图数仓让SQL分析快人一步</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/27">Stream4Graph：动态图上的增量计算</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/24">重磅发布！！！蚂蚁图团队开源高性能原生图存储系统CStore</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/25">TuGraph Analytics交互式图查询：让图所见即所得</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/26">TuGraph Analytics作业监控面板：运行时组件上的高效分析工具</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/23">世界第一！蚂蚁图计算TuGraph打破LDBC SNB-BI世界纪录</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/22">TuGraph Analytics云原生部署：基于K8S Operator的轻量级作业启动方案</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/21">TuGraph Analytics动态插件：快速集成大数据生态系统</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/20">开源TuGraph Analytics——是时候开始使用图计算了</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/18">TuGraph Analytics图计算快速上手之弱联通分量算法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/19">TuGraph Analytics图建模研发：为图计算业务提速增效</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/17">容器内mysql无法启动解决方案</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/16">TuGgraph-Analytics图计算快速上手之紧密中心度算法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/15">TuGraph Analytics流图计算之行为路径归因</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/14">为什么使用图进行关联运算比表Join更具吸引力？</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/13">TuGraph Analytics图计算快速上手之K-core算法</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/geaflow-website/blog/12">GeaFlow图计算快速上手之K-hop算法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/10">GeaFlow任务能力增强：通过API定制流图计算逻辑</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/11">GeaFlow图计算快速上手之K-hop算法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/9">分布式图计算如何实现？带你一窥图计算执行计划</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/8">GitHub上有哪些好项目？TuGraph-Analytics图计算快速上手之SSSP算法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/7">图加速数据湖分析-TuGraph和Hudi集成</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/6">TuGraph图计算快速上手之PageRank算法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/5">Kubernetes云原生实战：分布式TuGraph-Analytics实现图研发，构建第一个商业智能应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/4">从大数据到图计算-Graph On BigData</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/3">论文解读｜TuGraph Analytics 流式图计算论文入选国际顶会 SIGMOD</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/2">谁在以太坊区块链上循环交易？TuGraph+Kafka的0元流图解决方案</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/geaflow-website/blog/1">2023开放原子全球开源峰会，蚂蚁图计算平台开源业内首个工业级流图计算引擎</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">GeaFlow图计算快速上手之K-hop算法</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-08-21T00:00:00.000Z">August 21, 2023</time></div></header><div id="__blog-post-container" class="markdown"><p><font style="color:rgb(69, 69, 69)">作者：范志东</font></p>
<p><strong><font style="color:rgb(69, 69, 69)">TuGraph Analytics（内部项目名 GeaFlow）</font></strong><font style="color:rgb(69, 69, 69)">是蚂蚁集团开源的分布式实时图计算引擎，即流式图计算。通过 SQL+GQL 融合分析语言对表模型和图模型进行统一处理，实现了流、批、图一体化计算，并支持了 Exactly Once 语义、高可用以及一站式图研发平台等生产化能力。</font></p>
<p><font style="color:rgb(69, 69, 69)">开源项目代码目前托管在 GitHub，欢迎业界同仁、大数据/图计算技术爱好者关注我们的项目并参与共建。</font></p>
<p><strong><font style="color:rgb(69, 69, 69)">项目地址：</font></strong><a href="https://github.com/TuGraph-family/tugraph-analytics" target="_blank" rel="noopener noreferrer"><strong><font style="color:rgb(255, 81, 0)">https://github.com/TuGraph-family/tugraph-analytics</font></strong></a></p>
<p><strong><font style="color:rgb(69, 69, 69)">GeaFlow 论文【SIGMOD 2023】：</font></strong><a href="https://dl.acm.org/doi/abs/10.1145/3589771" target="_blank" rel="noopener noreferrer"><strong><font style="color:rgb(255, 81, 0)">GeaFlow: A Graph Extended and Accelerated Dataflow System</font></strong></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="概览"><font style="color:rgb(69, 69, 69)">概览</font><a href="#概览" class="hash-link" aria-label="Direct link to 概览" title="Direct link to 概览">​</a></h2>
<p><font style="color:rgb(69, 69, 69)">本文希望通过一张图描述清楚 TuGraph Analytics 的整体架构脉络和关键设计思路，以帮助大家快速对 TuGraph Analytics 项目的轮廓有个整体的认识。闲言少叙，直接上图。</font></p>
<p><img decoding="async" loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591348634-6e742d50-830e-44ac-9dcd-0afdce02eceb.png" alt="" class="img_ev3q"></p>
<p><font style="color:rgb(69, 69, 69)">TuGraph Analytics 开源技术架构一共分为五个部分：</font></p>
<ul>
<li><strong><font style="color:rgb(69, 69, 69)">DSL 层</font></strong><font style="color:rgb(69, 69, 69)">：即语言层。TuGraph Analytics 设计了 SQL+GQL 的融合分析语言，支持对表模型和图模型统一处理。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">Framework 层</font></strong><font style="color:rgb(69, 69, 69)">：即框架层。TuGraph Analytics 设计了面向 Graph 和 Stream 的两套 API 支持流、批、图融合计算，并实现了基于 Cycle 的统一分布式调度模型。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">State 层</font></strong><font style="color:rgb(69, 69, 69)">：即存储层。TuGraph Analytics 设计了面向 Graph 和 KV 的两套 API 支持表数据和图数据的混合存储，整体采用了 Sharing Nothing 的设计，并支持将数据持久化到远程存储。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">Console 平台</font></strong><font style="color:rgb(69, 69, 69)">：TuGraph Analytics 提供了一站式图研发平台，实现了图数据的建模、加工、分析能力，并提供了图作业的运维管控支持。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">执行环境</font></strong><font style="color:rgb(69, 69, 69)">：TuGraph Analytics 可以运行在多种异构执行环境，如 K8S、Ray 以及本地模式。</font></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dsl-层"><font style="color:rgb(69, 69, 69)">DSL 层</font><a href="#dsl-层" class="hash-link" aria-label="Direct link to dsl-层" title="Direct link to dsl-层">​</a></h2>
<p><font style="color:rgb(69, 69, 69)">DSL 层是一个典型的编译器技术架构，即语法分析、语义分析、中间代码生成(IR)、代码优化、目标代码生成（OBJ）的流程。</font></p>
<p><img decoding="async" loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591371971-1363f96a-0f25-472b-9929-374f2799f01e.png" alt="" class="img_ev3q"></p>
<ul>
<li><strong><font style="color:rgb(69, 69, 69)">语言设计</font></strong><font style="color:rgb(69, 69, 69)">：TuGraph Analytics 设计了 SQL+GQL 的融合语法，解决了图+表一体化分析的诉求。具体语法设计可以参考文章：</font><a href="https://github.com/TuGraph-family/tugraph-analytics/blob/master/docs/docs-en/application-development/dsl/overview.md" target="_blank" rel="noopener noreferrer"><font style="color:rgb(255, 81, 0)">DSL 语法文档</font></a></li>
<li><strong><font style="color:rgb(69, 69, 69)">语法分析</font></strong><font style="color:rgb(69, 69, 69)">：通过扩展 Calcite 的 SqlNode 和 SqlOperator，实现 SQL+GQL 的语法解析器，生成统一的语法树信息。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">语义分析</font></strong><font style="color:rgb(69, 69, 69)">：通过扩展 Calcite 的 Scope 和 Namespace，实现自定义 Validator，对语法树进行约束语义检查。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">中间代码生成</font></strong><font style="color:rgb(69, 69, 69)">：通过扩展 Calcite 的 RelNode，实现图上的 Logical RelNode，用于 GQL 语法的中间表示。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">代码优化</font></strong><font style="color:rgb(69, 69, 69)">：优化器实现了大量的优化规则（RBO）用于提升执行性能，未来也会引入 CBO。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">目标代码生成</font></strong><font style="color:rgb(69, 69, 69)">：代码生成器 Converter 负责将 Logical RelNode 转换为 Physical RelNode，即目标代码。Physical RelNode 可以直接翻译为 Graph/Table 上的 API 调用。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">自定义函数</font></strong><font style="color:rgb(69, 69, 69)">: TuGraph Analytics 提供了大量的内置系统函数，用户也可以根据需要注册自定义函数。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">自定义插件</font></strong><font style="color:rgb(69, 69, 69)">: TuGraph Analytics 允许用户扩展自己的 Connector 类型，以支持不同的数据源和数据格式。</font></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="framework-层"><font style="color:rgb(69, 69, 69)">Framework 层</font><a href="#framework-层" class="hash-link" aria-label="Direct link to framework-层" title="Direct link to framework-层">​</a></h2>
<p><font style="color:rgb(69, 69, 69)">Framework 层设计与 Flink/Spark 等同类大数据计算引擎有一定的相似性，即提供了类 FlumeJava（</font><a href="https://pages.cs.wisc.edu/~akella/CS838/F12/838-CloudPapers/FlumeJava.pdf" target="_blank" rel="noopener noreferrer"><font style="color:rgb(255, 81, 0)">FlumeJava: Easy, Efficient Data-Parallel Pipelines</font></a><font style="color:rgb(69, 69, 69)">）的统一高阶 API（简称 HLA），用户调用高阶 API 的过程会被转换为逻辑执行计划，逻辑执行计划执行一定的优化（如 ChainCombine、UnionPushUp 等）后，被转换为物理执行计划，物理执行计划会被调度器分发到分布式 Worker 上执行，最终 Worker 会回调用户传递的高阶 API 函数逻辑，实现整个分布式计算链路的执行。</font></p>
<p><img decoding="async" loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591421306-cce77bdd-6f01-4e3f-b7ea-70d2e985bc0d.png" alt="" class="img_ev3q"></p>
<ul>
<li><strong><font style="color:rgb(69, 69, 69)">高阶 API</font></strong><font style="color:rgb(69, 69, 69)">：TuGraph Analytics 通过 Environment 接口适配异构的分布式执行环境（K8S、Ray、Local），使用 Pipeline 封装了用户的数据处理流程，使用 Window 抽象统一了流处理（无界 Window）和批处理（有界 Window）。Graph 接口提供了静态图和动态图（流图）上的计算 API，如 append/snapshot/compute/traversal 等，Stream 接口提供了统一流批处理 API，如 map/reduce/join/keyBy 等。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">逻辑执行计划</font></strong><font style="color:rgb(69, 69, 69)">：逻辑执行计划信息统一封装在 PipelineGraph 对象内，将高阶 API 对应的算子（Operator）组织在 DAG 中，算子一共分为 5 大类：SourceOperator 对应数据源加载、OneInputOperator/TwoInputOperator 对应传统的数据处理、IteratorOperator 对应静态/动态图计算。DAG 中的点（PipelineVertex）记录了算子（Operator）的关键信息，如类型、并发度、算子函数等信息，边（PipelineEdge）则记录了数据 shuffle 的关键信息，如 Partition 规则（forward/broadcast/key 等）、编解码器等。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">物理执行计划</font></strong><font style="color:rgb(69, 69, 69)">：物理执行计划信息统一封装在 ExecutionGraph 对象内，并支持二级嵌套结构，以尽可能将可以流水线执行的子图（ExecutionVertexGroup）结构统一调度。图中示例的物理执行计划 DAG 被划分为三部分子图结构分别执行。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">调度器</font></strong><font style="color:rgb(69, 69, 69)">：TuGraph Analytics 设计了基于 Cycle 的调度器（CycleScheduler）实现对流、批、图的统一调度，调度过程通过事件驱动模型触发。物理执行计划中的每部分子图都会被转换为一个 ExecutionCycle 对象，调度器会向 Cycle 的头结点（Head）发送 Event，并接收 Cycle 尾结点（Tail）的发回的 Event，形成一个完整的调度闭环。对于流处理，每一轮 Cycle 调度会完成一个 Window 的数据的处理，并会一直不停地执行下去。对于批处理，整个 Cycle 调度仅执行一轮。对于图处理，每一轮 Cycle 调度会完成一次图计算迭代。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">运行时组件</font></strong><font style="color:rgb(69, 69, 69)">：TuGraph Analytics 运行时会拉起 Client、Master、Driver、Container 组件。当 Client 提交 Pipeline 给 Driver 后，会触发执行计划构建、分配 Task（ResourceManagement 提供资源）和调度。每个 Container 内可以运行多个 Worker 组件，不同 Worker 组件之间通过 Shuffle 模块交换数据，所有的 Worker 都需要定期向 Master 上报心跳（HeartbeatManagement），并向时序数据库上报运行时指标信息。另外 TuGraph Analytics 运行时也提供了故障容忍机制（FailOver），以便在异常/中断后能继续执行。</font></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="state-层"><font style="color:rgb(69, 69, 69)">State 层</font><a href="#state-层" class="hash-link" aria-label="Direct link to state-层" title="Direct link to state-层">​</a></h2>
<p><font style="color:rgb(69, 69, 69)">State 层设计相比于传统的大数据计算引擎，除了提供面向表数据的 KV 存储抽象，也支持了面向图数据的 Graph 存储抽象，以更好地支持面向图模型的 IO 性能优化。</font></p>
<p><img decoding="async" loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591361883-744efdac-273b-4d79-8238-a4db875cf0c7.png" alt="" class="img_ev3q"></p>
<ul>
<li><strong><font style="color:rgb(69, 69, 69)">State API</font></strong><font style="color:rgb(69, 69, 69)">：提供了面向 KV 存储 API，如 get/put/delete 等。以及面向图存储的 API，如 V/E/VE，以及点/边的 add/update/delete 等。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">State 执行层</font></strong><font style="color:rgb(69, 69, 69)">：通过 KeyGroup 的设计实现数据的 Sharding 和扩缩容能力，Accessor 提供了面向不同读写策略和数据模型的 IO 抽象，StateOperator 抽象了存储层 SPI，如 finish（刷盘）、archive（Checkpoint）、compact（压缩）、recover（恢复）等。另外，State 提供了多种 PushDown 优化以加速 IO 访问效率。通过自定义内存管理和面向属性的二级索引也会提供大量的存储访问优化手段。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">Store 层</font></strong><font style="color:rgb(69, 69, 69)">：TuGraph Analytics 支持了多种存储系统类型，并通过 StoreContext 封装了 Schema、序列化器，以及数据版本信息。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">持久化层</font></strong><font style="color:rgb(69, 69, 69)">：State 的数据支持持久化到远程存储系统，如 HDFS、OSS、S3 等。</font></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="console-平台"><font style="color:rgb(69, 69, 69)">Console 平台</font><a href="#console-平台" class="hash-link" aria-label="Direct link to console-平台" title="Direct link to console-平台">​</a></h2>
<p><font style="color:rgb(69, 69, 69)">Console 平台提供了一站式图研发、运维的平台能力，同时为引擎运行时提供元数据（Catalog）服务。</font></p>
<p><img decoding="async" loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591451238-c7783506-ae3c-49b9-be7f-a71610257ace.png" alt="" class="img_ev3q"></p>
<ul>
<li><strong><font style="color:rgb(69, 69, 69)">标准化 API</font></strong><font style="color:rgb(69, 69, 69)">：平台提供了标准化的 RESTful API 和认证机制，同时支持了页面端和应用端的统一 API 服务能力。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">任务研发</font></strong><font style="color:rgb(69, 69, 69)">：平台支持“关系-实体-属性”的图数据建模。基于字段映射配置，可以定义图数据传输任务，包括数据集成（Import）和数据分发（Export）。基于图表模型的图数据加工任务支持多样化的计算场景，如 Traversal、Compute、Mining 等。基于数据加速器的图数据服务，提供了多协议的实时分析能力，支持 BI、可视化分析工具的接入集成。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">构建提交</font></strong><font style="color:rgb(69, 69, 69)">：平台通过任务和作业的独立抽象，实现研发态与运维态的分离。任务开发完成后执行发布动作，会自动触发构建流水线（Release Builder），生成发布版本。任务提交器（Task Submitter）负责将发布版本的内容提交到执行环境，生成计算作业。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">作业运维</font></strong><font style="color:rgb(69, 69, 69)">：作业属于任务的运行态，平台提供了作业的操纵（启停、重置）、监控（指标、告警、审计）、调优（诊断、伸缩、调参）、调度等运维能力。作业的运行时资源会由资源池统一分配和管理。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">元数据服务</font></strong><font style="color:rgb(69, 69, 69)">：平台同时承载了引擎运行时的元数据服务能力，以实现研发与运维的自动化。元数据以实例维度进行隔离，实例内的研发资源可以根据名字直接访问，如点、边、图、表、视图、函数等。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">系统管理</font></strong><font style="color:rgb(69, 69, 69)">：平台提供了多租户隔离机制、细粒度用户权限控制，以及系统资源的管理能力。</font></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="执行环境"><font style="color:rgb(69, 69, 69)">执行环境</font><a href="#执行环境" class="hash-link" aria-label="Direct link to 执行环境" title="Direct link to 执行环境">​</a></h2>
<p><font style="color:rgb(69, 69, 69)">TuGraph Analytics 支持多种异构环境执行，以常见的 K8S 部署环境为例，其物理部署架构如下：</font></p>
<p><img decoding="async" loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591453805-84debc07-c1c0-44f2-8bd2-411ba2a4ee5b.png" alt="" class="img_ev3q"></p>
<p><font style="color:rgb(69, 69, 69)">在 TuGraph Analytics 作业的全生命周期过程中，涉及的关键数据流程有：</font></p>
<ul>
<li><strong><font style="color:rgb(69, 69, 69)">研发阶段</font></strong><font style="color:rgb(69, 69, 69)">：Console 平台提供了实例下所有的研发资源的管理，用户可以在创建任务前，提前准备所需的研发资源信息，并存储在 Catalog。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">构建阶段</font></strong><font style="color:rgb(69, 69, 69)">：任务创建完成后，通过发布动作触发构建流水线，用户的 JAR 包、任务的 ZIP 包等会上传到 RemoteFileStore。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">提交阶段</font></strong><font style="color:rgb(69, 69, 69)">：作业提交时，Console 会根据作业的参数配置、运行时环境信息，以及远程文件地址等创建 KubernetesJobClient，既而会拉起 Client Pod，Client 会拉起 Master Pod，Master 会拉起 Container Pods 和 Driver Pod。所有的 Pod 拉起后，Client 会把作业的 Pipeline 发送给 Driver 执行，Driver 最终通过 Cycle 调度的 Events 与 Containers 交互。所有的 Pod 启动时都会从 RemoteFileStore 下载版本 JAR 包、用户 JAR 包、作业 ZIP 包等信息。Driver 对 DSL 代码编译时，也需要通过 Console 提供的 Catalog API 操作 Schema 信息。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">运行阶段</font></strong><font style="color:rgb(69, 69, 69)">：作业运行时，各个组件会上报不同的数据和信息。Master 会上报作业的心跳汇总信息，Driver 会上报作业的 Pipeline/Cycle 指标以及错误信息，Container 会上报作业的 Offset、指标定义以及错误信息等。RuntimeMetaStore 存储作业的 Pipeline/Cycle 指标、Offset、心跳汇总、错误等信息。HAMetaStore 存储各个运行组件的地址信息。DataStore 存储 State 数据和作业 FailOver 时所需的元数据信息。MetricStore 存储运行时指标信息。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">监控阶段</font></strong><font style="color:rgb(69, 69, 69)">：Console 会主要查询 RuntimeMetaStore 和 MetricStore 存储的信息用于作业的运行时监控。</font></li>
<li><strong><font style="color:rgb(69, 69, 69)">清理阶段</font></strong><font style="color:rgb(69, 69, 69)">：作业重置/删除时，Console 会对作业的 RuntimeMeta、HAMeta 以及部分 Data 做清理操作。</font></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结"><font style="color:rgb(69, 69, 69)">总结</font><a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p><font style="color:rgb(69, 69, 69)">希望通过以上的介绍，可以让大家对 TuGraph Analytics 开源技术架构有个比较清晰的了解，我们非常欢迎开源社区的技术爱好者参与到项目的建设中来。</font></p>
<p><font style="color:rgb(69, 69, 69)">如果您对 TuGraph Analytics 项目比较感兴趣，欢迎动动手指扫码直达 GitHub 仓库，为我们的项目加一颗 Star。【网络不畅可以尝试使用 VPN 访问】</font></p>
<p><font style="color:rgb(69, 69, 69)">GeaFlow(品牌名 TuGraph-Analytics) 已正式开源，欢迎大家关注！！！</font></p>
<p><font style="color:rgb(69, 69, 69)">欢迎给我们 Star 哦!</font></p>
<p><font style="color:rgb(69, 69, 69)">Welcome to give us a Star!</font></p>
<p><font style="color:rgb(69, 69, 69)">GitHub</font><font style="color:rgb(69, 69, 69)">👉</font><a href="https://github.com/TuGraph-family/tugraph-analytics" target="_blank" rel="noopener noreferrer"><font style="color:rgb(255, 81, 0)">https://github.com/TuGraph-family/tugraph-analytics</font></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="微信群"><font style="color:rgb(69, 69, 69)">微信群</font><a href="#微信群" class="hash-link" aria-label="Direct link to 微信群" title="Direct link to 微信群">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591363107-b610d139-419a-4cea-836a-be55ca928360.png" alt="" class="img_ev3q"></p>
<p><font style="color:rgb(69, 69, 69)">请点击项目链接下方微信二维码添加微信用户群：</font><a href="https://github.com/TuGraph-family/tugraph-analytics" target="_blank" rel="noopener noreferrer"><font style="color:rgb(255, 81, 0)">https://github.com/TuGraph-family/tugraph-analytics</font></a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/geaflow-website/blog/13"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">TuGraph Analytics图计算快速上手之K-core算法</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/geaflow-website/blog/10"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">GeaFlow任务能力增强：通过API定制流图计算逻辑</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概览" class="table-of-contents__link toc-highlight"><font style="color:rgb(69, 69, 69);">概览</font></a></li><li><a href="#dsl-层" class="table-of-contents__link toc-highlight"><font style="color:rgb(69, 69, 69);">DSL 层</font></a></li><li><a href="#framework-层" class="table-of-contents__link toc-highlight"><font style="color:rgb(69, 69, 69);">Framework 层</font></a></li><li><a href="#state-层" class="table-of-contents__link toc-highlight"><font style="color:rgb(69, 69, 69);">State 层</font></a></li><li><a href="#console-平台" class="table-of-contents__link toc-highlight"><font style="color:rgb(69, 69, 69);">Console 平台</font></a></li><li><a href="#执行环境" class="table-of-contents__link toc-highlight"><font style="color:rgb(69, 69, 69);">执行环境</font></a></li><li><a href="#总结" class="table-of-contents__link toc-highlight"><font style="color:rgb(69, 69, 69);">总结</font></a></li><li><a href="#微信群" class="table-of-contents__link toc-highlight"><font style="color:rgb(69, 69, 69);">微信群</font></a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/geaflow-website/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/geaflow-website/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>