---
title: GeaFlowä»»åŠ¡èƒ½åŠ›å¢å¼ºï¼šé€šè¿‡APIå®šåˆ¶æµå›¾è®¡ç®—é€»è¾‘
date: 2023-8-15
---

## <font style="color:rgb(69, 69, 69);">GeaFlow API ä»‹ç»</font>

<font style="color:rgb(69, 69, 69);">GeaFlow API æ˜¯å¯¹é«˜é˜¶ç”¨æˆ·æä¾›çš„å¼€å‘æ¥å£ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡ç¼–å†™ java ä»£ç æ¥ç¼–å†™è®¡ç®—ä½œä¸šï¼Œç›¸æ¯”äº DSLï¼ŒAPI çš„æ–¹å¼å¼€å‘æ›´åŠ çµæ´»ï¼Œä¹Ÿèƒ½å®ç°æ›´ä¸°å¯Œçš„åŠŸèƒ½å’Œæ›´å¤æ‚çš„è®¡ç®—é€»è¾‘ã€‚ åœ¨ GeaFlow ä¸­ï¼ŒAPI æ”¯æŒ Graph API å’Œ Stream API ä¸¤ç§ç±»å‹ï¼š</font>

<!-- truncate -->

- <font style="color:rgb(69, 69, 69);">Graph APIï¼šGraph æ˜¯ GeaFlow æ¡†æ¶çš„ä¸€ç­‰å…¬æ°‘ï¼Œå½“å‰ GeaFlow æ¡†æ¶æä¾›äº†ä¸€å¥—åŸºäº GraphView çš„å›¾è®¡ç®—ç¼–ç¨‹æ¥å£ï¼ŒåŒ…å«å›¾æ„å»ºã€å›¾è®¡ç®—åŠéå†ã€‚åœ¨ GeaFlow ä¸­æ”¯æŒ Static Graph å’Œ Dynamic Graph ä¸¤ç§ç±»å‹ã€‚</font>
  - <font style="color:rgb(69, 69, 69);">Static Graph APIï¼šé™æ€å›¾è®¡ç®— APIï¼ŒåŸºäºè¯¥ç±» API å¯ä»¥è¿›è¡Œå…¨é‡çš„å›¾è®¡ç®—æˆ–å›¾éå†ã€‚</font>
  - <font style="color:rgb(69, 69, 69);">Dynamic Graph APIï¼šåŠ¨æ€å›¾è®¡ç®— APIï¼ŒGeaFlow ä¸­ GraphView æ˜¯åŠ¨æ€å›¾çš„æ•°æ®æŠ½è±¡ï¼ŒåŸºäº GraphView ä¹‹ä¸Šï¼Œå¯ä»¥è¿›è¡ŒåŠ¨æ€å›¾è®¡ç®—æˆ–å›¾éå†ã€‚åŒæ—¶æ”¯æŒå¯¹ Graphview ç”Ÿæˆ Snapshot å¿«ç…§ï¼ŒåŸºäº Snapshot å¯ä»¥æä¾›å’Œ Static Graph API ä¸€æ ·çš„æ¥å£èƒ½åŠ›ã€‚</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591587472-328b525e-7b38-4a8f-ba15-2a59d73cd5c5.png)

- <font style="color:rgb(69, 69, 69);">Stream APIï¼šGeaFlow æä¾›äº†ä¸€å¥—é€šç”¨è®¡ç®—çš„ç¼–ç¨‹æ¥å£ï¼ŒåŒ…æ‹¬ source æ„å»ºã€æµæ‰¹è®¡ç®—åŠ sink è¾“å‡ºã€‚åœ¨ GeaFlow ä¸­æ”¯æŒ Batch å’Œ Stream ä¸¤ç§ç±»å‹ã€‚</font>
  - <font style="color:rgb(69, 69, 69);">Batch APIï¼šæ‰¹è®¡ç®— APIï¼ŒåŸºäºè¯¥ç±» API å¯ä»¥è¿›è¡Œæ‰¹é‡è®¡ç®—ã€‚</font>
  - <font style="color:rgb(69, 69, 69);">Stream APIï¼šæµè®¡ç®— APIï¼ŒGeaFlow ä¸­ StreamView æ˜¯åŠ¨æ€æµçš„æ•°æ®æŠ½è±¡ï¼ŒåŸºäº StreamView ä¹‹ä¸Šï¼Œå¯ä»¥è¿›è¡Œæµè®¡ç®—ã€‚</font>

<font style="color:rgb(69, 69, 69);">æ›´å¤š API çš„ä»‹ç»å¯å‚è€ƒ</font><font style="color:rgb(69, 69, 69);"> </font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics/blob/master/docs/docs-cn/application-development/api/overview.md</font>](https://github.com/TuGraph-family/tugraph-analytics/blob/master/docs/docs-cn/application-development/api/overview.md)

## <font style="color:rgb(69, 69, 69);">PageRank ç®—æ³•ç¤ºä¾‹</font>

<font style="color:rgb(69, 69, 69);">æœ¬ä¾‹å­æ˜¯ä»æ–‡ä»¶ä¸­è¯»å–ç‚¹è¾¹è¿›è¡Œæ„å›¾ï¼Œæ‰§è¡Œ pageRank ç®—æ³•åï¼Œå°†æ¯ä¸ªç‚¹çš„ pageRank å€¼è¿›è¡Œæ‰“å°ã€‚ å…¶ä¸­ï¼Œç”¨æˆ·éœ€è¦å®ç° AbstractVcFuncï¼Œåœ¨ compute æ–¹æ³•ä¸­è¿›è¡Œæ¯ä¸€è½®è¿­ä»£çš„è®¡ç®—é€»è¾‘ã€‚ åœ¨æœ¬ä¾‹å­ä¸­ï¼Œåªè®¡ç®—äº†ä¸¤è½®è¿­ä»£çš„ç»“æœã€‚åœ¨ç¬¬ä¸€è½®ä¸­ï¼Œæ¯ä¸ªç‚¹éƒ½ä¼šå‘é‚»å±…ç‚¹å‘é€å½“å‰ç‚¹çš„ value å€¼ï¼Œè€Œåœ¨ç¬¬äºŒè½®ä¸­ï¼Œæ¯ä¸ªç‚¹æ”¶åˆ°é‚»å±…ç‚¹å‘é€çš„æ¶ˆæ¯ï¼Œå°†å…¶ value å€¼è¿›è¡Œç´¯åŠ ï¼Œå¹¶æ›´æ–°ä¸ºè‡ªå·±çš„ value å€¼ï¼Œå³ä¸ºæœ€åçš„ PageRank å€¼ã€‚</font>

```plain
public class PageRank {

    private static final Logger LOGGER = LoggerFactory.getLogger(PageRank.class);

    public static final String RESULT_FILE_PATH = "./target/tmp/data/result/pagerank";

    private static final double alpha = 0.85;

    public static void main(String[] args) {
        Environment environment = EnvironmentUtil.loadEnvironment(args);
        IPipelineResult result = PageRank.submit(environment);
        PipelineResultCollect.get(result);
        environment.shutdown();
    }

    public static IPipelineResult submit(Environment environment) {
        Pipeline pipeline = PipelineFactory.buildPipeline(environment);
        Configuration envConfig = environment.getEnvironmentContext().getConfig();
        envConfig.put(FileSink.OUTPUT_DIR, RESULT_FILE_PATH);
        ResultValidator.cleanResult(RESULT_FILE_PATH);

        pipeline.submit((PipelineTask) pipelineTaskCxt -> {
            Configuration conf = pipelineTaskCxt.getConfig();
            PWindowSource<IVertex<Integer, Double>> prVertices =
                pipelineTaskCxt.buildSource(new FileSource<>("email_vertex",
                        line -> {
                            String[] fields = line.split(",");
                            IVertex<Integer, Double> vertex = new ValueVertex<>(
                                Integer.valueOf(fields[0]), Double.valueOf(fields[1]));
                            return Collections.singletonList(vertex);
                        }), AllWindow.getInstance())
                    .withParallelism(conf.getInteger(ExampleConfigKeys.SOURCE_PARALLELISM));

            PWindowSource<IEdge<Integer, Integer>> prEdges = pipelineTaskCxt.buildSource(new FileSource<>("email_edge",
                    line -> {
                        String[] fields = line.split(",");
                        IEdge<Integer, Integer> edge = new ValueEdge<>(Integer.valueOf(fields[0]), Integer.valueOf(fields[1]), 1);
                        return Collections.singletonList(edge);
                    }), AllWindow.getInstance())
                .withParallelism(conf.getInteger(ExampleConfigKeys.SOURCE_PARALLELISM));

            int iterationParallelism = conf.getInteger(ExampleConfigKeys.ITERATOR_PARALLELISM);
            GraphViewDesc graphViewDesc = GraphViewBuilder
                .createGraphView(GraphViewBuilder.DEFAULT_GRAPH)
                .withShardNum(2)
                .withBackend(BackendType.Memory)
                .build();
            PGraphWindow<Integer, Double, Integer> graphWindow =
                pipelineTaskCxt.buildWindowStreamGraph(prVertices, prEdges, graphViewDesc);

            SinkFunction<IVertex<Integer, Double>> sink = ExampleSinkFunctionFactory.getSinkFunction(conf);
            graphWindow.compute(new PRAlgorithms(10))
                .compute(iterationParallelism)
                .getVertices()
                .sink(v -> {
                    LOGGER.info("result {}", v);
                })
                .withParallelism(conf.getInteger(ExampleConfigKeys.SINK_PARALLELISM));
        });

        return pipeline.execute();
    }

    public static class PRAlgorithms extends VertexCentricCompute<Integer, Double, Integer, Double> {

        public PRAlgorithms(long iterations) {
            super(iterations);
        }

        @Override
        public VertexCentricComputeFunction<Integer, Double, Integer, Double> getComputeFunction() {
            return new PRVertexCentricComputeFunction();
        }

        @Override
        public VertexCentricCombineFunction<Double> getCombineFunction() {
            return null;
        }

    }

    public static class PRVertexCentricComputeFunction extends AbstractVcFunc<Integer, Double, Integer, Double> {

        @Override
        public void compute(Integer vertexId,
                            Iterator<Double> messageIterator) {
            IVertex<Integer, Double> vertex = this.context.vertex().get();
            List<IEdge<Integer, Integer>> outEdges = context.edges().getOutEdges();
            if (this.context.getIterationId() == 1) {
                if (!outEdges.isEmpty()) {
                    this.context.sendMessageToNeighbors(vertex.getValue() / outEdges.size());
                }

            } else {
                double sum = 0;
                while (messageIterator.hasNext()) {
                    double value = messageIterator.next();
                    sum += value;
                }
                double pr = sum * alpha + (1 - alpha);
                this.context.setNewVertexValue(pr);

                if (!outEdges.isEmpty()) {
                    this.context.sendMessageToNeighbors(pr / outEdges.size());
                }
            }
        }

    }
}
```

## <font style="color:rgb(69, 69, 69);">æäº¤ API ä½œä¸š</font>

<font style="color:rgb(69, 69, 69);">(ä»¥å®¹å™¨æ¨¡å¼ï¼ŒPageRank ç®—æ³•ç¤ºä¾‹)</font>

### <font style="color:rgb(69, 69, 69);">ç®—æ³•æ‰“åŒ…</font>

<font style="color:rgb(69, 69, 69);">åœ¨æ–°çš„é¡¹ç›®ä¸­æ–°å»ºä¸€ä¸ª PageRank çš„ demoï¼Œpom ä¸­å¼•å…¥ geaflow ä¾èµ–</font>

```plain
<dependency>
	<groupId>com.antgroup.tugraph</groupId>
	<artifactId>geaflow-assembly</artifactId>
	<version>0.2-SNAPSHOT</version>
</dependency>
```

<font style="color:rgb(69, 69, 69);">æ–°å»º PageRank ç±»ï¼Œç¼–å†™ä¸Šè¿°ç›¸å…³</font>[<font style="color:rgb(255, 81, 0);">ä»£ç </font>](https://tugraph-analytics.github.io/opinion/2023/08/15/GeaFlow%E4%BB%BB%E5%8A%A1%E8%83%BD%E5%8A%9B%E5%A2%9E%E5%BC%BA-%E9%80%9A%E8%BF%87API%E5%AE%9A%E5%88%B6%E6%B5%81%E5%9B%BE%E8%AE%A1%E7%AE%97%E9%80%BB%E8%BE%91.html#xBvDN)<font style="color:rgb(69, 69, 69);">ã€‚ åœ¨é¡¹ç›® resources è·¯å¾„ä¸‹ï¼Œåˆ›å»ºæµ‹è¯•æ•°æ®æ–‡ä»¶ email_vertex å’Œ email_edgeï¼Œä»£ç ä¸­ä¼šä» resources://èµ„æºè·¯å¾„è¯»å–æ•°æ®è¿›è¡Œæ„å›¾ã€‚</font>

```plain
PWindowSource<IVertex<Integer, Double>> prVertices =
                pipelineTaskCxt.buildSource(new FileSource<>("email_vertex",
                        line -> {
                            String[] fields = line.split(",");
                            IVertex<Integer, Double> vertex = new ValueVertex<>(
                                Integer.valueOf(fields[0]), Double.valueOf(fields[1]));
                            return Collections.singletonList(vertex);
                        }), AllWindow.getInstance())
                    .withParallelism(conf.getInteger(ExampleConfigKeys.SOURCE_PARALLELISM));

   PWindowSource<IEdge<Integer, Integer>> prEdges = pipelineTaskCxt.buildSource(new FileSource<>("email_edge",
                    line -> {
                        String[] fields = line.split(",");
                        IEdge<Integer, Integer> edge = new ValueEdge<>(Integer.valueOf(fields[0]), Integer.valueOf(fields[1]), 1);
                        return Collections.singletonList(edge);
                    }), AllWindow.getInstance())
                .withParallelism(conf.getInteger(ExampleConfigKeys.SOURCE_PARALLELISM));
```

<font style="color:rgb(69, 69, 69);">email_vertex</font>

```plain
0,1
1,1
2,1
3,1
4,1
5,1
6,1
7,1
8,1
9,1
```

<font style="color:rgb(69, 69, 69);">email_edge</font>

```plain
4,3
0,1
2,3
4,6
2,4
6,8
0,2
4,8
0,5
0,7
0,8
9,0
7,0
7,1
7,2
9,5
3,0
7,4
5,3
7,5
1,0
5,4
9,8
3,4
7,9
3,7
3,8
1,6
8,0
6,0
6,2
8,5
4,2
```

<font style="color:rgb(69, 69, 69);">maven æ‰“åŒ…ï¼Œåœ¨ target ç›®å½•è·å–ç®—æ³•çš„ jar åŒ…</font>

```plain
mvn clean install
```

### <font style="color:rgb(69, 69, 69);">æ–°å¢ HLA å›¾ä»»åŠ¡</font>

<font style="color:rgb(69, 69, 69);">åœ¨ GeaFlow Console ä¸­æ–°å¢å›¾ä»»åŠ¡ï¼Œä»»åŠ¡ç±»å‹é€‰æ‹©â€œHLAâ€ï¼Œ å¹¶ä¸Šä¼  jar åŒ…ï¼ˆæˆ–è€…é€‰æ‹©å·²å­˜åœ¨çš„ jar åŒ…ï¼‰ï¼Œå…¶ä¸­</font>**<font style="color:rgb(69, 69, 69);">entryClass ä¸ºç®—æ³•ä¸»å‡½æ•°æ‰€åœ¨çš„ç±»</font>**<font style="color:rgb(69, 69, 69);">ã€‚ ç‚¹å‡»â€œæäº¤â€ï¼Œåˆ›å»ºä»»åŠ¡ã€‚</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591590404-b0d9dba0-8242-4828-83c5-5d287f52d17f.png)

### <font style="color:rgb(69, 69, 69);">æäº¤ä½œä¸š</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591591636-292847a9-f57b-47ac-b775-b00ede04cc6f.png)

<font style="color:rgb(69, 69, 69);">ç‚¹å‡»â€å‘å¸ƒâ€ï¼Œå¯è¿›å…¥ä½œä¸šè¯¦æƒ…ç•Œé¢ï¼Œç‚¹å‡»â€œæäº¤â€å³å¯æäº¤ä½œä¸šã€‚</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591590394-11aadd16-414b-4a0f-8392-8f1e90b705f4.png)

### <font style="color:rgb(69, 69, 69);">æŸ¥çœ‹è¿è¡Œç»“æœ</font>

<font style="color:rgb(69, 69, 69);">è¿›å…¥å®¹å™¨ /tmp/logs/task/ ç›®å½•ä¸‹ï¼ŒæŸ¥çœ‹å¯¹åº”ä½œä¸šçš„æ—¥å¿—ï¼Œå¯çœ‹åˆ°æ—¥å¿—ä¸­æ‰“å°äº†æœ€ç»ˆè®¡ç®—å¾—åˆ°çš„æ¯ä¸ªç‚¹çš„ pageRank å€¼ã€‚</font>

```plain
2023-08-01 16:51:38 INFO  PageRank:107 - result ValueVertex(vertexId:0, value:1.5718675107490019)
2023-08-01 16:51:38 INFO  PageRank:107 - result ValueVertex(vertexId:1, value:0.5176947080197076)
2023-08-01 16:51:38 INFO  PageRank:107 - result ValueVertex(vertexId:2, value:1.0201253300467092)
2023-08-01 16:51:38 INFO  PageRank:107 - result ValueVertex(vertexId:3, value:1.3753756869824914)
2023-08-01 16:51:38 INFO  PageRank:107 - result ValueVertex(vertexId:4, value:1.4583114077692536)
2023-08-01 16:51:38 INFO  PageRank:107 - result ValueVertex(vertexId:5, value:1.1341668910561529)
2023-08-01 16:51:38 INFO  PageRank:107 - result ValueVertex(vertexId:6, value:0.6798184364673463)
2023-08-01 16:51:38 INFO  PageRank:107 - result ValueVertex(vertexId:7, value:0.70935427506243)
2023-08-01 16:51:38 INFO  PageRank:107 - result ValueVertex(vertexId:8, value:1.2827529511906106)
2023-08-01 16:51:38 INFO  PageRank:107 - result ValueVertex(vertexId:9, value:0.2505328026562969)
```

<font style="color:rgb(69, 69, 69);">å¯åœ¨ä½œä¸šè¯¦æƒ…ä¸­æŸ¥çœ‹è¿è¡Œè¯¦æƒ…ï¼Œ</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591590486-76f2ce41-6b9f-4491-813d-841089beb31a.png)

**<font style="color:rgb(69, 69, 69);">è‡³æ­¤ï¼Œæˆ‘ä»¬å°±æˆåŠŸä½¿ç”¨ Geaflow å®ç°å¹¶è¿è¡Œ API ä»»åŠ¡äº†ï¼æ˜¯ä¸æ˜¯è¶…ç®€å•ï¼å¿«æ¥è¯•ä¸€è¯•å§ï¼</font>**

<font style="color:rgb(69, 69, 69);">GeaFlow(å“ç‰Œå TuGraph-Analytics) å·²æ­£å¼å¼€æºï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ï¼ï¼ï¼</font>

<font style="color:rgb(69, 69, 69);">æ¬¢è¿ç»™æˆ‘ä»¬ Star å“¦!</font>

<font style="color:rgb(69, 69, 69);">Welcome to give us a Star!</font>

<font style="color:rgb(69, 69, 69);">GitHub</font><font style="color:rgb(69, 69, 69);">ğŸ‘‰</font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)

## <font style="color:rgb(69, 69, 69);">å¾®ä¿¡ç¾¤</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755591588572-1344f1ed-fe8f-413f-93f7-82917c2bb412.png)

<font style="color:rgb(69, 69, 69);">è¯·ç‚¹å‡»é¡¹ç›®é“¾æ¥ä¸‹æ–¹å¾®ä¿¡äºŒç»´ç æ·»åŠ å¾®ä¿¡ç”¨æˆ·ç¾¤ï¼š</font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)
