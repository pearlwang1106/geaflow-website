---
title: GeaFlow交互式图查询：让图所见即所得
date: 2023-12-13
---

<font style="color:rgb(69, 69, 69);">作者：廖梵抒</font>

<font style="color:rgb(69, 69, 69);">GeaFlow 提供了 OLAP 图分析能力，实现图上的交互式查询，用户在构图并导入数据之后，可以通过输入 GQL 语句对图查询分析，并以可视化的方式直观地展示点边结果。</font>

<!-- truncate -->

**<font style="color:rgb(69, 69, 69);">OLAP 架构</font>**

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590314672-217ac41f-0cc4-4a84-be62-3cb7f7bd69f9.png)

<font style="color:rgb(69, 69, 69);">在 GeaFlow OLAP 架构中，主要以下组件:</font>

1. **<font style="color:rgb(69, 69, 69);">Client</font>**<font style="color:rgb(69, 69, 69);">: 用户通过 Client 提交查询语句, Client 负责和 Coordinator 交互，发送查询请求。</font>
2. **<font style="color:rgb(69, 69, 69);">Coordinator</font>**<font style="color:rgb(69, 69, 69);">: 接收来自 Client 查询请求，将查询中的 GQL 语句进行解析、优化，构建查询的执行计划（执行计划的生成逻辑可参考</font>[<font style="color:rgb(255, 81, 0);">《分布式图计算如何实现？带你一窥图计算执行计划》</font>](https://zhuanlan.zhihu.com/p/647441899)<font style="color:rgb(69, 69, 69);">），并将任务调度给 Woker 执行。</font>
3. **<font style="color:rgb(69, 69, 69);">Worker</font>**<font style="color:rgb(69, 69, 69);">：具体分布式地执行任务的单元，接收到 Coordinator 发送的 Pipeline，执行具体的计算和查询逻辑。</font>
4. **<font style="color:rgb(69, 69, 69);">Meta Service</font>**<font style="color:rgb(69, 69, 69);">: 服务注册管理，Coordinator 启动后，会将服务的地址和端口向 MetaService 进行注册，Client 提交查询时从 MetaService 获取 Coordinator 的服务地址，进行连接。目前支持 http 和 rpc 两种方式。</font>

<font style="color:rgb(69, 69, 69);">组件间执行流程如下：</font>![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590315445-c918816a-31a2-4911-9fab-5b23318cb5cc.png)

**<font style="color:rgb(69, 69, 69);">操作指南</font>**

## <font style="color:rgb(69, 69, 69);">1. 定义图模型</font>

<font style="color:rgb(69, 69, 69);">以下图为例，图中有 2 种点 person 和 software，以及 2 种边 knows 和 creates。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590314484-02ee4e80-b7f1-462a-9609-adc7cea799cf.png)

<font style="color:rgb(69, 69, 69);">图模型定义可参考</font>[<font style="color:rgb(255, 81, 0);">《GeaFlow 图建模研发：为图计算业务提速增效》</font>](https://zhuanlan.zhihu.com/p/663270153)<font style="color:rgb(69, 69, 69);">，图定义语法为：</font>

```plain
CREATE GRAPH dy_modern (
	Vertex person (
	  id bigint ID,
	  name varchar,
	  age int
	),
	Vertex software (
	  id bigint ID,
	  name varchar,
	  lang varchar
	),
	Edge knows (
	  srcId bigint SOURCE ID,
	  targetId bigint DESTINATION ID,
	  weight int
	),
	Edge creates (
	  srcId bigint SOURCE ID,
  	targetId bigint DESTINATION ID,
  	weight int
	)
) WITH (
	storeType='rocksdb',
	shardCount = 2
);
```

## <font style="color:rgb(69, 69, 69);">2. 准备图数据</font>

<font style="color:rgb(69, 69, 69);">创建“加工”类型图任务，发布生成图作业。</font>

```plain
USE GRAPH dy_modern;

INSERT INTO dy_modern.person(id, name, age)
SELECT 1, 'jim', 20
UNION ALL
SELECT 2, 'kate', 22
UNION ALL
SELECT 3, 'tom', 24;

INSERT INTO dy_modern.software(id, name, lang)
SELECT 4, 'software1', 'java'
UNION ALL
SELECT 5, 'software2', 'java';

INSERT INTO dy_modern.knows
SELECT 1,2,2
UNION ALL
SELECT 1,3,3
UNION ALL
SELECT 3,2,3;

INSERT INTO dy_modern.creates
SELECT 2,4,6
UNION ALL
SELECT 3,5,8
UNION ALL
SELECT 3,4,8;
```

**<font style="color:rgb(69, 69, 69);">图作业需要的 worker 数为 23</font>**<font style="color:rgb(69, 69, 69);">，在作业界面将参数进行修改，之后提交作业运行。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590315011-1d8d3015-87fb-441f-b561-c1d181b6a7d7.png)

## <font style="color:rgb(69, 69, 69);">3. 创建查询服务</font>

<font style="color:rgb(69, 69, 69);">创建图查询服务, 任务类型选择“图查询”，目标图选择刚才创建的图。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590314435-4a49ece4-df3f-4087-8159-ca06228a42ae.png)

<font style="color:rgb(69, 69, 69);">发布任务后，使用默认参数即可，提交作业。</font>

## <font style="color:rgb(69, 69, 69);">4. 执行查询</font>

<font style="color:rgb(69, 69, 69);">图查询服务的作业变成 RUNNING 状态后，可在任务界面点击“查询”进入图查询界面</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590315411-f1d6bd46-dd30-4669-8fd4-369134e8f8ab.png)

<font style="color:rgb(69, 69, 69);">输入相应的 gql 查询语句，点击“执行”，即可得到查询结果。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590315531-0a5f5365-c490-403e-9355-8cdd2487f8ac.png)

## <font style="color:rgb(69, 69, 69);">5. 图可视化</font>

<font style="color:rgb(69, 69, 69);">点击某个点，可以查看点关联的具体信息和属性，以及关联的其他点边。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590316056-02b1be65-6fdc-4e0d-a05e-a3d0bc886c52.png)

<font style="color:rgb(69, 69, 69);">除了可视化的方式，也可以 json 形式看到返回的结果。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590316461-4f593cb8-f608-4d69-aa76-de08c087d4c2.png)

**<font style="color:rgb(69, 69, 69);">至此，我们就成功使用 GeaFlow 实现了图上的交互式查询！是不是超简单！快来试一试吧！</font>**

**<font style="color:rgb(69, 69, 69);">欢迎关注我们的 GitHub 仓库：</font>**<font style="color:rgb(69, 69, 69);"> </font><font style="color:rgb(69, 69, 69);">👉</font><font style="color:rgb(69, 69, 69);"> </font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)

---

<font style="color:rgb(69, 69, 69);">GeaFlow(品牌名 TuGraph-Analytics) 已正式开源，欢迎大家关注！！！</font>

<font style="color:rgb(69, 69, 69);">欢迎给我们 Star 哦!</font>

<font style="color:rgb(69, 69, 69);">Welcome to give us a Star!</font>

<font style="color:rgb(69, 69, 69);">GitHub</font><font style="color:rgb(69, 69, 69);">👉</font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)

**<font style="color:rgb(69, 69, 69);">微信群</font>**

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590316761-27cf4d87-fbf6-4e20-abbf-d497f571f007.png)

<font style="color:rgb(69, 69, 69);">请点击项目链接下方微信二维码添加微信用户群：</font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)
