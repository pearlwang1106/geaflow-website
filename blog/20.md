---
title: 开源TuGraph Analytics——是时候开始使用图计算了
date: 2023-10-23
---

<font style="color:rgb(69, 69, 69);">作者：TuGraph</font>

## <font style="color:rgb(69, 69, 69);">项目地址：</font><font style="color:rgb(69, 69, 69);"> </font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)

## <font style="color:rgb(69, 69, 69);">项目文档地址:</font><font style="color:rgb(69, 69, 69);"> </font>[<font style="color:rgb(255, 81, 0);">https://tugraph-analytics.readthedocs.io/en/latest/index_cn/</font>](https://tugraph-analytics.readthedocs.io/en/latest/index_cn/)

## <font style="color:rgb(69, 69, 69);">博客地址：</font><font style="color:rgb(69, 69, 69);"> </font>[<font style="color:rgb(255, 81, 0);">https://tugraph-analytics.github.io/</font>](https://tugraph-analytics.github.io/)

## <font style="color:rgb(69, 69, 69);">类别：Java</font>

## <font style="color:rgb(69, 69, 69);">项目描述：</font>

<font style="color:rgb(69, 69, 69);">GeaFlow(品牌名 TuGraph-Analytics)是蚂蚁集团开源的分布式流式图计算引擎，已广泛应用于数仓加速、金融风控、知识图谱以及社交网络等场景。</font>

<font style="color:rgb(69, 69, 69);">TuGraph-Analytics 的核心能力是以自研图存储为数据底座，支持用户书写 SQL+GQL 的融合语言，驱动流批一体的流式图计算。 使用 TuGraph-Analytics，用户可以继续沿用 SQL 进行查询，利用引擎的自动转图查询，同时享受图计算极大的性能优势红利。</font>

<font style="color:rgb(69, 69, 69);">在任何时候，用户可以无缝切换到 GQL 等图查询语言，以高效处理复杂多度的关系运算，如 3 度以上的 Join、各类图算法、图特征分析等。 基于图表一体、流批一体的计算引擎，用户可以自然忽略流和批的区隔，只需关注业务需求，计算将在实时计算和离线分析之间无缝切换。</font>

<!-- truncate -->

## <font style="color:rgb(69, 69, 69);">使用 TuGraph-Analytics 的好处：</font>

- <font style="color:rgb(69, 69, 69);">支撑万亿级别超大规模图服务的稳定性</font>
- <font style="color:rgb(69, 69, 69);">内建图研发管理平台，一站式图计算</font>
- <font style="color:rgb(69, 69, 69);">业界独创的 SQL+GQL 融合语言，无需学习，以 SQL 驱动图计算</font>
- <font style="color:rgb(69, 69, 69);">流批一体的 API 描述，支持自定义图计算任务</font>
- <font style="color:rgb(69, 69, 69);">图和表集成处理</font>
- <font style="color:rgb(69, 69, 69);">基于 K8S 的云原生部署支持</font>

### <font style="color:rgb(69, 69, 69);">使用案例一 无需学习，零基础开始 SQL 图计算</font>

<font style="color:rgb(69, 69, 69);">TuGraph-Analytics 提供融合 GQL 和 SQL 样式的查询语言，使得图计算的结果与表查询等价。</font>

<font style="color:rgb(69, 69, 69);">这意味着下图中 GQL 和 SQL 两种描述都可以达到类似的效果，用户无需预先学习专业图查询语言，即可使用 SQL 驱动图计算。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755608950376-1033c9a5-76d4-443f-a2b6-fbffb6191d56.png)

<font style="color:rgb(69, 69, 69);">GeaFlow DSL 引擎层支持了 SQL 中的 Join 自动转化为 GQL 执行，同时支持常用的 Project、Filter、Aggregate 等一系列 SQL 操作转为图计算执行。 用户可以自由混用 SQL 和 GQL 样式查询，同时做图匹配和表查询。</font>

<font style="color:rgb(69, 69, 69);">使用表建模的分析系统只支持 SQL join 一种方式进行关系分析，这在复杂场景中能力十分局限。 图建模的 TuGraph-Analytics 支持用户在任何时候，无缝切换到专业性强的图查询语言，以高效处理 SQL 难以表达的复杂关系运算。</font>

### <font style="color:rgb(69, 69, 69);">使用案例二 进行复杂流图匹配，洞察商业价值</font>

<font style="color:rgb(69, 69, 69);">使用专业图计算系统 TuGraph-Analytics，只需 40 行代码，即可搭建一个端到端的循环交易实时检测系统。</font>

<font style="color:rgb(69, 69, 69);">首先我们使用历史数据创建交易大图，命名为 ethereum_transaction_network。 接着把来自 Kafka 的实时交易流 table_new_trade 不断添加到命名为 ethereum_transaction_network 的图中。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755608970990-ee92b2a7-cce4-4468-b691-d302937205ec.png)

<font style="color:rgb(69, 69, 69);">每当有新的交易到达的时刻，系统都将触发一次 3 跳循环交易模式的检查， 把更新的结果存入位于 Kafka 的外部表 tbl_circular_trade，可以很方便地分发给下游组件。</font>

<font style="color:rgb(69, 69, 69);">打开一个 Kafka Producer，产生消息流，将交易不断发送给 Kafka，如左侧终端窗口所示。 最新的循环交易检出结果打印在右侧的 Kafka Consumer 窗口中。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755608983849-35ac9d0d-55cb-48b8-a01e-1e99aceaf11d.png)

<font style="color:rgb(69, 69, 69);">当添加一些新的交易日志时，右侧的 Kafka Consumer 窗口中也实时更新了新的循环交易检出结果，响应十分迅速。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755609001322-7f019699-9e69-4b85-a557-5d4ec75b1d41.png)

<font style="color:rgb(69, 69, 69);">此案例中，GeaFlow 结合 Kafka 轻松搭建起交易听单->交易网络生成->实时循环交易检出->给下游发送消息完整的金融级实时解决方案。</font>

### <font style="color:rgb(69, 69, 69);">使用案例三 利用内建 Console 进行研发管理</font>

<font style="color:rgb(69, 69, 69);">通过管控平台 Console，分析人员可以提交一系列研究作业。 这些图查询作业会通过 GeaFlow 引擎自动提交到 K8S 集群中分布式地运行，大大提高了数据分析的能力和效率。</font>

<font style="color:rgb(69, 69, 69);">在 GeaFlow Console 中新增图任务，任务类型选择“HLA”， 并上传 jar 包，其中 entryClass 为算法主函数所在的类。 点击“提交”，创建任务。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755609016219-5bd192fb-f3ea-4357-bc27-0ab3f8fd55f8.png)

<font style="color:rgb(69, 69, 69);">点击”发布”，可进入作业详情界面，点击“提交”即可提交作业。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755609028453-4a77fefb-1e77-4b11-9b70-1bdbb077826c.png)

<font style="color:rgb(69, 69, 69);">运行的图查询均可在 Console 界面查看，方便回溯和管理，并且可在作业详情中查看运行详情，</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755609039536-d72dae2f-54f7-479c-9721-f44dc664016e.png)

### <font style="color:rgb(69, 69, 69);">使用案例四 自研图算法，嵌入 GQL 语言执行</font>

<font style="color:rgb(69, 69, 69);">用户可以基于 UDGA(User Defined Graph Algorithm)接口实现自定义图算法。 通过将 UDGA 上传至 console 平台，可以类似 SQL Function 的方式在 GQL 查询中调用。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755609052563-e9b6e50c-852d-48fb-b334-7e7586287a03.png)

<font style="color:rgb(69, 69, 69);">用户可以在 GQL 图查询语句中嵌入图算法，使用方式如下所示：</font>

```plain
INSERT INTO tbl_result
CALL wcc() YIELD (vid, component)
RETURN vid, component
;
```

<font style="color:rgb(69, 69, 69);">内置算法或者 UDF 在 BuildInSqlFunctionTable 中进行注册。对于非内置算法，可以通过 create function 语句来创建。</font>

```plain
Create funciton wcc as 'com.antgroup.geaflow.dsl.udf.graph.WeakConnectedComponents';
```

## <font style="color:rgb(69, 69, 69);">系统设计图</font>

<font style="color:rgb(69, 69, 69);">TuGraph Analytics 开源技术架构一共分为五个部分：</font>

- **<font style="color:rgb(69, 69, 69);">DSL 层</font>**<font style="color:rgb(69, 69, 69);">：即语言层。TuGraph Analytics 设计了 SQL+GQL 的融合分析语言，支持对表模型和图模型统一处理。</font>
- **<font style="color:rgb(69, 69, 69);">Framework 层</font>**<font style="color:rgb(69, 69, 69);">：即框架层。TuGraph Analytics 设计了面向 Graph 和 Stream 的两套 API 支持流、批、图融合计算，并实现了基于 Cycle 的统一分布式调度模型。</font>
- **<font style="color:rgb(69, 69, 69);">State 层</font>**<font style="color:rgb(69, 69, 69);">：即存储层。TuGraph Analytics 设计了面向 Graph 和 KV 的两套 API 支持表数据和图数据的混合存储，整体采用了 Sharing Nothing 的设计，并支持将数据持久化到远程存储。</font>
- **<font style="color:rgb(69, 69, 69);">Console 平台</font>**<font style="color:rgb(69, 69, 69);">：TuGraph Analytics 提供了一站式图研发平台，实现了图数据的建模、加工、分析能力，并提供了图作业的运维管控支持。</font>
- **<font style="color:rgb(69, 69, 69);">执行环境</font>**<font style="color:rgb(69, 69, 69);">：TuGraph Analytics 可以运行在多种异构执行环境，如 K8S、Ray 以及本地模式。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755609067341-d777e122-207f-4c18-8d7b-a0ef8151b861.png)

## <font style="color:rgb(69, 69, 69);">Benchmark</font>

<font style="color:rgb(69, 69, 69);">我们模拟依次执行一跳、两跳和三跳关系运算的场景。足以见得，越是复杂的多跳关系计算，关系模型中 Join 的性能表现越差。在总时间对比中，利用图的 Match 计算能够节约超过 90%的耗时。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755609080630-9132bd40-3ffb-4f98-ab93-fb083c1fbfe0.png)

<font style="color:rgb(69, 69, 69);">图 1</font>

---

<font style="color:rgb(69, 69, 69);">GeaFlow(品牌名 TuGraph-Analytics) 已正式开源，欢迎大家关注！！！</font>

<font style="color:rgb(69, 69, 69);">欢迎给我们 Star 哦!</font>

<font style="color:rgb(69, 69, 69);">Welcome to give us a Star!</font>

<font style="color:rgb(69, 69, 69);">GitHub</font><font style="color:rgb(69, 69, 69);">👉</font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)

#### <font style="color:rgb(69, 69, 69);">微信群</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755609098935-d268d785-ff3c-4a2d-85c6-2db615589c9c.png)

<font style="color:rgb(69, 69, 69);">请点击项目链接下方微信二维码添加微信用户群：</font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)
