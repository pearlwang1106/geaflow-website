---
title: GeaFlow交互式图查询：让图所见即所得
date: 2024-1-4
---

<font style="color:rgb(63, 63, 63);">GeaFlow 提供了 OLAP 图分析能力，实现图上的交互式查询，用户在构图并导入数据之后，可以通过输入 GQL 语句对图查询分析，并以可视化的方式直观地展示点边结果。  
</font>

<!-- truncate -->

## <font style="color:rgb(63, 63, 63);">OLAP 架构</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/webp/96961/1756793183950-2d44a88b-b840-49f1-998f-c883fc7ceb09.webp)

<font style="color:rgb(136, 136, 136);">OLAP 架构</font>

<font style="color:rgb(63, 63, 63);">在 GeaFlow OLAP 架构中，主要以下组件:</font>

**<font style="color:rgb(63, 63, 63);">Client</font>**<font style="color:rgb(63, 63, 63);">: 用户通过 Client 提交查询语句, Client 负责和 Coordinator 交互，发送查询请求。</font>

**<font style="color:rgb(63, 63, 63);">Coordinator</font>**<font style="color:rgb(63, 63, 63);">: 接收来自 Client 查询请求，将查询中的 GQL 语句进行解析、优化，构建查询的执行计划（执行计划的生成逻辑可参考《分布式图计算如何实现？带你一窥图计算执行计划》[1]），并将任务调度给 Woker 执行。</font>

**<font style="color:rgb(63, 63, 63);">Worker</font>**<font style="color:rgb(63, 63, 63);">：具体分布式地执行任务的单元，接收到 Coordinator 发送的 Pipeline，执行具体的计算和查询逻辑。</font>

**<font style="color:rgb(63, 63, 63);">Meta Service</font>**<font style="color:rgb(63, 63, 63);">: 服务注册管理，Coordinator 启动后，会将服务的地址和端口向 MetaService 进行注册，Client 提交查询时从 MetaService 获取 Coordinator 的服务地址，进行连接。目前支持 http 和 rpc 两种方式。</font>

<font style="color:rgb(63, 63, 63);">组件间执行流程如下：</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/webp/96961/1756793184025-3b077813-e7af-45d2-8ead-e5764bddf94f.webp)

<font style="color:rgb(136, 136, 136);">OLAP 流程</font>

## <font style="color:rgb(63, 63, 63);">操作指南</font>

### 1. 定义图模型

<font style="color:rgb(63, 63, 63);">以下图为例，图中有 2 种点 person 和 software，以及 2 种边 knows 和 creates。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/webp/96961/1756793183977-5952392b-e986-470e-9636-15b7737547a8.webp)

<font style="color:rgb(136, 136, 136);">图模型</font>

<font style="color:rgb(63, 63, 63);">图模型定义可参考</font><font style="color:rgb(87, 107, 149);">《GeaFlow 图建模研发：为图计算业务提速增效》</font><sup><font style="color:rgb(87, 107, 149);">[2]</font></sup><font style="color:rgb(63, 63, 63);">，图定义语法为：</font>

```plain
CREATE GRAPH dy_modern (
    Vertex person (
      id bigint ID,
      name varchar,
      age int
    ),
    Vertex software (
      id bigint ID,
      name varchar,
      lang varchar
    ),
    Edge knows (
      srcId bigint SOURCE ID,
      targetId bigint DESTINATION ID,
      weight int
    ),
    Edge creates (
      srcId bigint SOURCE ID,
      targetId bigint DESTINATION ID,
      weight int
    )
) WITH (
    storeType='rocksdb',
    shardCount = 2
);
```

### 2. 准备图数据

<font style="color:rgb(63, 63, 63);">创建“加工”类型图任务，发布生成图作业。</font>

```plain
USE GRAPH dy_modern;

INSERT INTO dy_modern.person(id, name, age)
SELECT 1, 'jim', 20
UNION ALL
SELECT 2, 'kate', 22
UNION ALL
SELECT 3, 'tom', 24;

INSERT INTO dy_modern.software(id, name, lang)
SELECT 4, 'software1', 'java'
UNION ALL
SELECT 5, 'software2', 'java';

INSERT INTO dy_modern.knows
SELECT 1,2,2
UNION ALL
SELECT 1,3,3
UNION ALL
SELECT 3,2,3;

INSERT INTO dy_modern.creates
SELECT 2,4,6
UNION ALL
SELECT 3,5,8
UNION ALL
SELECT 3,4,8;
```

<font style="color:rgb(63, 63, 63);">图作业需要的 worker 数为 23，在作业界面将参数进行修改，之后提交作业运行。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/webp/96961/1756793183977-6437fe99-797d-470b-812f-bd48a39cd685.webp)

<font style="color:rgb(136, 136, 136);">Worker 数配置</font>

### 3. 创建查询服务

<font style="color:rgb(63, 63, 63);">创建图查询服务, 任务类型选择“图查询”，目标图选择刚才创建的图。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/webp/96961/1756793184030-ee4463dc-9aeb-4fd1-beb6-0cdfd088d8ce.webp)

<font style="color:rgb(136, 136, 136);">创建查询服务</font>

<font style="color:rgb(63, 63, 63);">发布任务后，使用默认参数即可，提交作业。</font>

### 4. 执行查询

<font style="color:rgb(63, 63, 63);">图查询服务的作业变成 RUNNING 状态后，可在任务界面点击“查询”进入图查询界面</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1756793184729-9360feab-ba39-4c29-b1a7-2fe1c863a0b2.png)

<font style="color:rgb(136, 136, 136);">进入图查询</font>

<font style="color:rgb(63, 63, 63);">输入相应的 gql 查询语句，点击“执行”，即可得到查询结果。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/webp/96961/1756793184848-b374e007-b237-48fe-b346-5b5b9c8c09cd.webp)

<font style="color:rgb(136, 136, 136);">执行图查询</font>

### 5. 图可视化

<font style="color:rgb(63, 63, 63);">点击某个点，可以查看点关联的具体信息和属性，以及关联的其他点边。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1756793184816-f3a57b58-9324-4dc3-9c52-f7e1b6bee163.png)

<font style="color:rgb(136, 136, 136);">点边视图</font>

<font style="color:rgb(63, 63, 63);">除了可视化的方式，也可以 json 形式看到返回的结果。</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1756793184833-dd7ab588-8ff3-480f-9b96-d0aaadc23d30.png)

<font style="color:rgb(136, 136, 136);">JSON 视图</font>

<font style="color:rgb(63, 63, 63);">至此，我们就成功使用 GeaFlow 实现了图上的交互式查询！是不是超简单！快来试一试吧！</font>
