---
title: GeaFlowäº‘åŸç”Ÿéƒ¨ç½²ï¼šåŸºäºK8S Operatorçš„è½»é‡çº§ä½œä¸šå¯åŠ¨æ–¹æ¡ˆ
date: 2023-11-30
---

<font style="color:rgb(69, 69, 69);">ä½œè€…ï¼šä¸ä¸€</font>

### <font style="color:rgb(69, 69, 69);">èƒŒæ™¯</font>

<font style="color:rgb(69, 69, 69);">GeaFlow ä½œä¸šå¯ä»¥é€šè¿‡ Console æäº¤éƒ¨ç½²åˆ° K8S é›†ç¾¤ï¼Œä½† Console æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Web ç³»ç»Ÿï¼Œéƒ¨ç½²å½¢æ€ä¸Šç›¸å¯¹è¾ƒé‡ã€‚åœ¨å¹³å°å·¥å…·ç³»ç»Ÿæ¥å…¥æˆ–å¤§æ•°æ®ç”Ÿæ€é›†æˆåœºæ™¯ä¸­ï¼Œéœ€è¦æ›´è½»é‡çº§çš„å¿«é€Ÿæ¥å…¥ GeaFlow çš„æ–¹æ¡ˆã€‚ æˆ‘ä»¬æ–°å¢äº†æ¨¡å— geaflow-kubernetes-operatorï¼Œå¯ä»¥é€šè¿‡æ›´è½»é‡çº§çš„ YAML æ–‡ä»¶é…ç½®æ–¹å¼ï¼Œå¯¹ GeaFlow ä½œä¸šè¿›è¡Œæè¿°é…ç½®ã€‚åŒæ—¶æ›´æ–¹ä¾¿åœ°ç›‘æ§å’Œç®¡ç†é›†ç¾¤ä¸‹çš„æ‰€æœ‰ GeaFlow ä½œä¸šï¼Œå¹¶é€šè¿‡ CR(Custom Resource)çš„åˆ›å»º/ä¿®æ”¹/åˆ é™¤æ¥ç®¡ç†ä½œä¸šçš„ç”Ÿå‘½å‘¨æœŸå’Œå…ƒä¿¡æ¯ï¼Œå¯ä»¥å®ç°åªé€šè¿‡ kubectl å‘½ä»¤å®ç°ä»»åŠ¡æ“çºµã€‚æˆ‘ä»¬ä¹Ÿæä¾›äº†ä¸€ä¸ªå®æ—¶ dashboard é¡µé¢ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ç™½å±åŒ–æŸ¥çœ‹æ‰€æœ‰ä½œä¸šçŠ¶æ€å’Œä¿¡æ¯ã€‚</font>

<!-- truncate -->

### <font style="color:rgb(69, 69, 69);">éƒ¨ç½² K8S Operator</font>

<font style="color:rgb(69, 69, 69);">GeaFlow æä¾›äº† geaflow-kubernetes-operator æ¨¡å—ï¼Œå¯é€šè¿‡ Helm å‘½ä»¤ä¸€é”®éƒ¨ç½²åˆ° K8Sã€‚éƒ¨ç½²å®Œæˆä¸­ï¼Œä¼šå‘ K8S é›†ç¾¤æ³¨å†Œä¸€ä¸ªåä¸º geaflowjob çš„è‡ªå®šä¹‰èµ„æºã€‚ï¼ˆç›¸å¯¹äº K8S å†…ç½® podã€serviceã€deployment ç­‰ç³»ç»Ÿèµ„æºè€Œè¨€ï¼‰ å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™ä¸€ä¸ª CR çš„ YAML é…ç½®æ–‡ä»¶æäº¤ç»™ K8Sï¼Œå°±å¯ä»¥è‡ªåŠ¨æ‹‰èµ·ä½œä¸šäº†ã€‚</font>

- <font style="color:rgb(69, 69, 69);">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ„å»º Operator é•œåƒï¼Œé¡¹ç›®ä»£ç æ„å»ºè¦æ±‚ JDK11 ç‰ˆæœ¬ï¼Œå› æ­¤éœ€è¦å•ç‹¬åˆ‡æ¢ JDK ç‰ˆæœ¬ç¼–è¯‘æ„å»ºã€‚</font>

```plain
$ ./build-operator.sh
```

- <font style="color:rgb(69, 69, 69);">è¿›å…¥é¡¹ç›®ç›®å½• geaflow-kubernetes-operator ä¸‹ï¼Œé€šè¿‡ Helm ä¸€é”®å®‰è£… operatorã€‚</font>

```plain
$ helm install geaflow-kubernetes-operator helm/geaflow-kubernetes-operator
```

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590583286-58dbe4bc-c84e-4ced-a1e0-f30dff7baade.png)

- <font style="color:rgb(69, 69, 69);">åœ¨ K8S Dashboard ä¸­æŸ¥çœ‹ pod æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590583430-d8d3e5a4-332b-4ed2-9183-adc92ba394d4.png)

### <font style="color:rgb(69, 69, 69);">æäº¤ä½œä¸š</font>

<font style="color:rgb(69, 69, 69);">K8S Operator æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œåï¼Œå°±å¯ä»¥ç¼–å†™ CR çš„ YAML æ–‡ä»¶è¿›è¡Œä½œä¸šæäº¤äº†ã€‚</font>

```plain
$ kubectl apply geaflow-example.yml
```

<font style="color:rgb(69, 69, 69);">è¿™é‡Œä½¿ç”¨é¡¹ç›®å†…ç½®ç¤ºä¾‹ä½œä¸šä¸¾ä¾‹ï¼Œå…¶ YAML æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</font>

```plain
apiVersion: geaflow.antgroup.com/v1
kind: GeaflowJob
metadata:
	# ä½œä¸šåç§°
  name: geaflow-example
spec:
	# ä½œä¸šä½¿ç”¨çš„GeaFlowé•œåƒ
  image: geaflow:0.1
  # ä½œä¸šæ‹‰å–é•œåƒçš„ç­–ç•¥
  imagePullPolicy: IfNotPresent
  # ä½œä¸šä½¿ç”¨çš„k8s service account
  serviceAccount: geaflow
  # ä½œä¸šjavaè¿›ç¨‹çš„ä¸»ç±»
  entryClass: com.antgroup.geaflow.example.graph.statical.compute.sssp.SSSP
  clientSpec:
    # client podç›¸å…³çš„èµ„æºè®¾ç½®
    resource:
      cpuCores: 1
      memoryMb: 1000
      jvmOptions: -Xmx800m,-Xms800m,-Xmn300m
  masterSpec:
    # master podç›¸å…³çš„èµ„æºè®¾ç½®
    resource:
      cpuCores: 1
      memoryMb: 1000
      jvmOptions: -Xmx800m,-Xms800m,-Xmn300m
  driverSpec:
    # driver podç›¸å…³çš„èµ„æºè®¾ç½®
    resource:
      cpuCores: 1
      memoryMb: 1000
      jvmOptions: -Xmx800m,-Xms800m,-Xmn300m
    # driverä¸ªæ•°
    driverNum: 1
  containerSpec:
    # container podç›¸å…³çš„èµ„æºè®¾ç½®
    resource:
      cpuCores: 1
      memoryMb: 1000
      jvmOptions: -Xmx800m,-Xms800m,-Xmn300m
    # containerä¸ªæ•°
    containerNum: 1
    # æ¯ä¸ªcontainerå†…éƒ¨çš„workerä¸ªæ•°(çº¿ç¨‹æ•°)
    workerNumPerContainer: 4
  userSpec:
    # ä½œä¸šæŒ‡æ ‡ç›¸å…³é…ç½®
    metricConfig:
      geaflow.metric.reporters: slf4j
      geaflow.metric.stats.type: memory
    # ä½œä¸šå­˜å‚¨ç›¸å…³é…ç½®
    stateConfig:
      geaflow.file.persistent.type: LOCAL
		  geaflow.store.redis.host: host.minikube.internal
      geaflow.store.redis.port: 6379
    # ç”¨æˆ·è‡ªå®šä¹‰å‚æ•°é…ç½®
    additionalArgs:
      geaflow.system.state.backend.type: MEMORY
```

<font style="color:rgb(69, 69, 69);">K8S ç¯å¢ƒä¸Šçš„ä½œä¸šå¼ºä¾èµ–äº Redis ç»„ä»¶ï¼Œè‹¥ä½ å·²ç»éƒ¨ç½²äº† Redisï¼Œåˆ™å¯ä»¥åœ¨ geaflow-example.yaml ä¸­æä¾› Redis ä¸»æœºå’Œç«¯å£å·ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡ Docker å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªæœ¬åœ° Redis æœåŠ¡ï¼Œé»˜è®¤åœ°å€ host.minikube.internal å¯ç›´æ¥è®¿é—®ã€‚</font>

```plain
docker pull redis:latest
docker run -p 6379:6379 --name geaflow_redis redis:latest
```

#### <font style="color:rgb(69, 69, 69);">æäº¤ API ä»»åŠ¡</font>

<font style="color:rgb(69, 69, 69);">å¯¹äºæäº¤ HLA ä»»åŠ¡çš„æƒ…å†µï¼Œéœ€è¦é¢å¤–æ³¨æ„ä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š</font>

- <font style="color:rgb(69, 69, 69);">spec.entryClassï¼šå¿…å¡«ã€‚</font>
- <font style="color:rgb(69, 69, 69);">spec.udfJarsï¼šé€‰å¡«ï¼Œä¸€èˆ¬å¡«å†™ API ä»»åŠ¡çš„ JAR æ–‡ä»¶çš„ url åœ°å€ã€‚</font>

```plain
spec:
	# å¿…å¡«
	entryClass: com.example.MyEntryClass
	# å¯é€‰
	udfJars:
  	- name: myJob.jar
    	url: http://url-path-to-myJob.jar
```

#### <font style="color:rgb(69, 69, 69);">æäº¤ DSL ä»»åŠ¡</font>

<font style="color:rgb(69, 69, 69);">å¯¹äºæäº¤ DSL ä»»åŠ¡çš„æƒ…å†µï¼Œéœ€è¦é¢å¤–æ³¨æ„ä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š</font>

- <font style="color:rgb(69, 69, 69);">spec.entryClassï¼šä¸å¡«ï¼Œç•™ç©ºï¼ˆç”¨äºåŒºåˆ†æ˜¯ API ä½œä¸šè¿˜æ˜¯ DSL ä½œä¸šï¼‰ã€‚</font>
- <font style="color:rgb(69, 69, 69);">spec.gqlFileï¼šå¿…å¡«ï¼Œè¯·å¡«å†™è‡ªå·±æ–‡ä»¶çš„åç§°å’Œ url åœ°å€ã€‚</font>
- <font style="color:rgb(69, 69, 69);">spec.udfJarsï¼šé€‰å¡«ï¼Œå¦‚éœ€ UDF çš„è¯ï¼Œè¯·å¡«å†™ UDF JAR æ–‡ä»¶çš„ url åœ°å€ã€‚</font>

```plain
spec:
	# ä¸å¡«
	# entryClass: com.example.MyEntryClass
	# å¿…å¡«
  gqlFile:
    # nameå¿…é¡»å¡«å†™æ­£ç¡®ï¼Œå¦åˆ™æ— æ³•æ‰¾åˆ°å¯¹åº”æ–‡ä»¶
    name: myGql.gql
    url: http://url-path-to-myGql.gql
	# å¯é€‰
	udfJars:
  	- name: myUdf.jar
    	url: http://url-path-to-myUdf.jar
```

<font style="color:rgb(69, 69, 69);">å…³äº DSL ä»»åŠ¡å’Œ HLA ä»»åŠ¡çš„æ›´å¤šå‚æ•°ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ç›®å½• geaflow-kubernetes-operator/example ç›®å½•ä¸­å‡†å¤‡äº†ä¸¤ä¸ª demo ä½œä¸šä¾›å¤§å®¶å‚è€ƒï¼Œè¯·åˆ†åˆ«å‚è€ƒé¡¹ç›®ä¸­çš„ç¤ºä¾‹æ–‡ä»¶ï¼š</font>

- <font style="color:rgb(69, 69, 69);">example/example-dsl.yml</font>
- <font style="color:rgb(69, 69, 69);">example/example-hla.ymlã€‚</font>

### <font style="color:rgb(69, 69, 69);">æŸ¥çœ‹ä½œä¸šçŠ¶æ€</font>

<font style="color:rgb(69, 69, 69);">å¯ä»¥è®¿é—® K8S Dashboard æŸ¥çœ‹ pod æ˜¯å¦è¢«æ‹‰èµ·ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹ CR çš„çŠ¶æ€æ˜¯å¦å·²ç»æ­£å¸¸è¿è¡Œã€‚</font>

```plain
$ kubectl get geaflowjob geaflow-example
```

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590583238-367e66b9-a41d-4535-ac05-08be6fcbb1f0.png)

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590583491-40041e22-3a2f-44b3-b484-66d504ec3721.png)

<font style="color:rgb(69, 69, 69);">è‹¥åœ¨æäº¤è¿‡ç¨‹ä¸­å¤±è´¥ï¼Œåˆ™çŠ¶æ€ä¼šå˜ä¸º FAILEDã€‚è‹¥éœ€å®šä½åŸå› ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ã€‚</font>

```plain
$ kubectl get geaflowjobs geaflow-example -o yaml
```

### <font style="color:rgb(69, 69, 69);">æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</font>

<font style="color:rgb(69, 69, 69);">Operator è‡ªå¸¦ä¸€ä¸ªå‰ç«¯é¡µé¢ï¼Œå¯ä»¥å±•ç¤ºé›†ç¾¤çš„åŸºæœ¬ä¿¡æ¯ã€æ‰€æœ‰ä½œä¸šçš„çŠ¶æ€ã€é”™è¯¯ä¿¡æ¯ã€ä»¥åŠå®Œæ•´çš„é…ç½®ï¼Œå¹¶åšäº†åˆ†ç±»ç»Ÿè®¡ã€‚å¯ä»¥é€šè¿‡è®¿é—® Operator çš„ service æˆ–è€… pod çš„ 8089 ç«¯å£æ¥æ‰“å¼€é¡µé¢ã€‚</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590583442-473045cc-500a-45d2-86fb-01b32f5e40ec.png)

**<font style="color:rgb(69, 69, 69);">å¤‡æ³¨</font>**<font style="color:rgb(69, 69, 69);">ï¼š</font>

_<font style="color:rgb(130, 130, 130);">åœ¨ minikube ç¯å¢ƒä¸­ï¼Œéœ€è¦é€šè¿‡ portforward å°† Operator çš„ pod ä»£ç†åˆ°æœ¬åœ°ç«¯å£ï¼ˆé»˜è®¤ä¸º 8089 ç«¯å£ï¼‰ï¼Œè¯·å°† operator-pod-name æ›¿æ¢ä¸ºå®é™…çš„ operator pod åç§°ï¼Œç„¶åé€šè¿‡æµè§ˆå™¨è®¿é—® localhost:8089 å³å¯æ‰“å¼€é¡µé¢ã€‚</font>_

```plain
$kubectl port-forward ${operator-pod-name} 8089:8089
```

**<font style="color:rgb(69, 69, 69);">è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº† GeaFlow ä½œä¸šçš„è½»é‡çº§æäº¤å’Œè¿è¡Œï¼æ˜¯ä¸æ˜¯è¶…ç®€å•ï¼å¿«æ¥è¯•ä¸€è¯•å§ï¼</font>**

---

<font style="color:rgb(69, 69, 69);">GeaFlow(å“ç‰Œå TuGraph-Analytics) å·²æ­£å¼å¼€æºï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ï¼ï¼ï¼</font>

<font style="color:rgb(69, 69, 69);">æ¬¢è¿ç»™æˆ‘ä»¬ Star å“¦!</font>

<font style="color:rgb(69, 69, 69);">Welcome to give us a Star!</font>

<font style="color:rgb(69, 69, 69);">GitHub</font><font style="color:rgb(69, 69, 69);">ğŸ‘‰</font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)

#### <font style="color:rgb(69, 69, 69);">å¾®ä¿¡ç¾¤</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590585021-69acf3f9-1bf6-42ff-b94b-62ce8d3b6f9c.png)

<font style="color:rgb(69, 69, 69);">è¯·ç‚¹å‡»é¡¹ç›®é“¾æ¥ä¸‹æ–¹å¾®ä¿¡äºŒç»´ç æ·»åŠ å¾®ä¿¡ç”¨æˆ·ç¾¤ï¼š</font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)
