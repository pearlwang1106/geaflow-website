---
title: TuGraph Analyticså›¾è®¡ç®—å¿«é€Ÿä¸Šæ‰‹ä¹‹å¼±è”é€šåˆ†é‡ç®—æ³•
date: 2023-10-16
---

<font style="color:rgb(69, 69, 69);">ä½œè€…ï¼šå¼ å¥‡</font>

## <font style="color:rgb(69, 69, 69);">TuGraph Analytics ç®€ä»‹</font>

<font style="color:rgb(69, 69, 69);">TuGraph Analytics æ˜¯èš‚èšé›†å›¢è¿‘æœŸå¼€æºçš„åˆ†å¸ƒå¼æµå¼å›¾è®¡ç®—ï¼Œç›®å‰å¹¿æ³›åº”ç”¨åœ¨èš‚èšé›†å›¢çš„é‡‘èã€ç¤¾äº¤ã€é£æ§ç­‰è¯¸å¤šé¢†åŸŸã€‚æ›´å¤šè¯¦ç»†å†…å®¹å¯å‚è€ƒ TuGraph Analytics çš„ github é¦–é¡µï¼ˆ</font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)<font style="color:rgb(69, 69, 69);">ï¼‰ï¼Œæ¬¢è¿å›½å†…å¤–å¼€å‘è€…ä»¬ä¸æˆ‘ä»¬å…±å»º TuGraph Analytics ç¤¾åŒºï¼Œå£®å¤§æµå›¾äº§ä¸šç”Ÿæ€ã€‚</font>

<!-- truncate -->

## <font style="color:rgb(69, 69, 69);">å¼±è”é€šåˆ†é‡ç®—æ³•ä»‹ç»</font>

<font style="color:rgb(69, 69, 69);">å¼±è”é€šåˆ†é‡å›¾ç®—æ³•ï¼ˆWeakly Connected Components Algorithmï¼‰æ˜¯ä¸€ç§ç”¨äºæ‰¾åˆ°å›¾ä¸­æ‰€æœ‰å¼±è”é€šåˆ†é‡çš„ç®—æ³•ã€‚å¼±è”é€šåˆ†é‡æ˜¯æŒ‡åœ¨æœ‰å‘å›¾ä¸­ï¼Œå¦‚æœå¿½ç•¥æ‰€æœ‰è¾¹çš„æ–¹å‘ï¼Œç›¸äº’ä¹‹é—´æ˜¯è¿é€šçš„èŠ‚ç‚¹é›†åˆã€‚</font>

<font style="color:rgb(69, 69, 69);">ç®—æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯é€šè¿‡æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰æˆ–å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰éå†å›¾çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¯¹äºæ¯ä¸ªæœªè®¿é—®è¿‡çš„èŠ‚ç‚¹ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„è”é€šåˆ†é‡ã€‚åœ¨éå†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹çš„é‚»å±…èŠ‚ç‚¹å·²ç»è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†å…¶åŠ å…¥å½“å‰è”é€šåˆ†é‡ä¸­ï¼Œå¹¶ç»§ç»­éå†é‚»å±…èŠ‚ç‚¹ã€‚</font>

<font style="color:rgb(69, 69, 69);">é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç®—æ³•èƒ½å¤Ÿæ‰¾åˆ°å›¾ä¸­æ‰€æœ‰å¼±è”é€šåˆ†é‡ï¼Œå¹¶å°†æ¯ä¸ªåˆ†é‡çš„èŠ‚ç‚¹é›†åˆè¿›è¡Œæ ‡è®°æˆ–å­˜å‚¨èµ·æ¥ã€‚æœ€ç»ˆï¼Œç®—æ³•è¿”å›æ‰€æœ‰å¼±è”é€šåˆ†é‡çš„é›†åˆã€‚</font>

<font style="color:rgb(69, 69, 69);">å¼±è”é€šåˆ†é‡å›¾ç®—æ³•å¯ä»¥åº”ç”¨äºè®¸å¤šå®é™…é—®é¢˜ï¼Œä¾‹å¦‚ç¤¾äº¤ç½‘ç»œåˆ†æä¸­çš„ç”¨æˆ·ç¾¤ä½“åˆ’åˆ†ã€ç½‘é¡µé“¾æ¥åˆ†æä¸­çš„ç½‘é¡µç¾¤ç»„åˆ’åˆ†ç­‰ã€‚å®ƒèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ç†è§£å›¾ä¸­ä¸åŒåˆ†é‡ä¹‹é—´çš„å…³ç³»ï¼Œä»è€Œæ›´å¥½åœ°åˆ†æå›¾çš„ç»“æ„å’Œç‰¹æ€§ã€‚</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590865396-ffe17ed9-cdca-4b4b-8abc-15b9c1fc0772.png)

## <font style="color:rgb(69, 69, 69);">åœ¨ TuGraph Analytics ä¸Šå®ç°å¼±è”é€šåˆ†é‡ç®—æ³•</font>

### <font style="color:rgb(69, 69, 69);">ä½¿ç”¨æ–¹å¼</font>

<font style="color:rgb(69, 69, 69);">ç”¨æˆ·å¯ä»¥åœ¨ GQL å›¾æŸ¥è¯¢è¯­å¥ä¸­åµŒå…¥å›¾ç®—æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</font>

```plain
INSERT INTO tbl_result
CALL wcc() YIELD (vid, component)
RETURN vid, component
;
```

<font style="color:rgb(69, 69, 69);">é€šè¿‡ CALL è¯­å¥è°ƒç”¨å…·ä½“çš„ç®—æ³•ï¼Œé€šè¿‡ YIELD å®šä¹‰ç®—æ³•çš„è¿”å›å­—æ®µã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¹ˆåšçš„å‰ææ˜¯ç®—æ³• udf éœ€è¦æ³¨å†Œæˆ–è€…åˆ›å»ºåæ‰èƒ½ä½¿ç”¨ã€‚DSL å†…ç½®ç®—æ³•æˆ–è€… UDF åœ¨ BuildInSqlFunctionTable ä¸­è¿›è¡Œæ³¨å†Œã€‚å¯¹äºéå†…ç½®ç®—æ³•ï¼Œå¯ä»¥é€šè¿‡ create function è¯­å¥æ¥åˆ›å»ºã€‚</font>

```plain
Create funciton wcc as 'com.antgroup.geaflow.dsl.udf.graph.WeakConnectedComponents';
```

### <font style="color:rgb(69, 69, 69);">ç®—æ³•å®ç°</font>

<font style="color:rgb(69, 69, 69);">TuGraph Analytics ä¸Šå®ç°å›¾ç®—æ³•éœ€è¦å®ç° AlgorithmUserFunction æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</font>

```plain
public interface AlgorithmUserFunction<K, M> extends Serializable {

    /**
     * Init method for the function.
     * @param context The runtime context.
     * @param params  The parameters for the function.
     */
    void init(AlgorithmRuntimeContext<K, M> context, Object[] params);

    /**
     * Processing method for each vertex and the messages it received.
     */
    void process(RowVertex vertex, Iterator<M> messages);

    /**
     * Finish method called by each vertex upon algorithm convergence.
     */
    void finish(RowVertex vertex);

    /**
     * Returns the output type for the function.
     */
    StructType getOutputType();
}
```

#### <font style="color:rgb(69, 69, 69);">init</font>

<font style="color:rgb(69, 69, 69);">é¦–å…ˆï¼Œinit æ–¹æ³•åœ¨ worker åˆå§‹åŒ–æ—¶è°ƒç”¨ï¼Œç”¨æˆ·å¾€ç®—æ³• udf ä¸­ä¼ å…¥çš„å‚æ•°ï¼Œä¼šæ”¾åœ¨ params æ•°ç»„å˜é‡é‡Œã€‚æ¯”å¦‚ wcc(10)ï¼Œè¿™é‡Œçš„ params[0] = 10ã€‚</font>

```plain
public void init(AlgorithmRuntimeContext<Object, String> context, Object[] parameters) {
    this.context = context;
    if (parameters.length > 2) {
        throw new IllegalArgumentException(
            Only support zero or more arguments, false arguments "
                + "usage: func([alpha, [convergence, [max_iteration]]])");
    }
	// è®¾ç½®æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¯¥å‚æ•°ï¼Œæœ€å¤§è¿­ä»£æ¬¡æ•°é»˜è®¤ä¸º20
    if (parameters.length > 0) {
        iteration = Integer.parseInt(String.valueOf(parameters[0]));
    }
	// è®¾ç½®è¾“å‡ºç»“æœè”é€šåˆ†é‡çš„keyï¼Œé»˜è®¤ä¸º"component"
    if (parameters.length > 1) {
        keyFieldName =String.valueOf(parameters[1]);
    }
}
```

#### <font style="color:rgb(69, 69, 69);">process</font>

<font style="color:rgb(69, 69, 69);">process æ–¹æ³•æ˜¯æ¯è½®è¿­ä»£æ‰§è¡Œçš„æ ¸å¿ƒæ–¹æ³•ï¼Œå¼±è”é€šåˆ†é‡ç®—æ³•çš„æ ¸å¿ƒé€»è¾‘å°±å®ç°åœ¨è¯¥æ–¹æ³•é‡Œã€‚åœ¨è¿™é‡Œï¼Œç¬¬ä¸€è½®è¿­ä»£æ—¶æˆ‘ä»¬è®¾ç½®æ¯ä¸ªç‚¹çš„ value åˆå§‹å€¼ä¸ºè¯¥ç‚¹çš„ idï¼Œç„¶åå°†è¯¥ id é€šè¿‡å‡ºè¾¹å’Œå…¥è¾¹å‘å…¶é‚»å±…èŠ‚ç‚¹ä¼ é€’å‡ºå»ã€‚åœ¨æ­¤åçš„æ¯è½®è¿­ä»£é‡Œï¼Œæ¯ä¸ªæ”¶åˆ°é‚»å±…èŠ‚ç‚¹æ¶ˆæ¯çš„èŠ‚ç‚¹ä¼šå–å‡ºæ¶ˆæ¯é‡Œçš„æœ€å°å€¼ï¼Œä½œä¸ºè¯¥èŠ‚ç‚¹çš„æ–°å€¼ï¼Œç„¶åå†å°†è¯¥æœ€å°å€¼ä¼ é€’ç»™å…¶ä»–é‚»å±…èŠ‚ç‚¹ã€‚åˆ°æœ€åï¼Œæ‰€æœ‰è”é€šåˆ†é‡çš„èŠ‚ç‚¹çš„å€¼éƒ½ä¼šè¢«æŸ“è‰²æˆè¿™ä¸ªè”é€šç½‘ç»œé‡Œçš„èŠ‚ç‚¹æœ€å°å€¼ã€‚</font>

```plain
public void process(RowVertex vertex, Iterator<String> messages) {
    List<RowEdge> edges = new ArrayList<>(context.loadEdges(EdgeDirection.BOTH));
    if (context.getCurrentIterationId() == 1L) {
        String initValue = String.valueOf(vertex.getId());
        sendMessageToNeighbors(edges, initValue);
        context.sendMessage(vertex.getId(), String.valueOf(vertex.getId()));
        context.updateVertexValue(ObjectRow.create(initValue));
    } else if (context.getCurrentIterationId() < iteration) {
        String minComponent = messages.next();
        while (messages.hasNext()) {
            String next = messages.next();
            if (next.compareTo(minComponent) < 0) {
                minComponent = next;
            }
        }
        sendMessageToNeighbors(edges, minComponent);
        context.sendMessage(vertex.getId(), minComponent);
        context.updateVertexValue(ObjectRow.create(minComponent));
    }
}

private void sendMessageToNeighbors(List<RowEdge> edges, String message) {
    for (RowEdge rowEdge : edges) {
        context.sendMessage(rowEdge.getTargetId(), message);
    }
}
```

#### <font style="color:rgb(69, 69, 69);">finish</font>

<font style="color:rgb(69, 69, 69);">finish æ–¹æ³•åœ¨è¿­ä»£æœ€ç»ˆæ”¶æ•›æ—¶ä¼šè¢«è°ƒç”¨ï¼Œæ­¤æ—¶æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè¢«æŸ“è‰²æˆäº†å®ƒæ‰€åœ¨è”é€šç½‘ç»œé‡Œçš„èŠ‚ç‚¹æœ€å°å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç»“æœè¾“å‡ºã€‚</font>

```plain
public void finish(RowVertex vertex) {
    String component = (String) vertex.getValue().getField(0, StringType.INSTANCE);
    context.take(ObjectRow.create(vertex.getId(), component));
}
```

#### <font style="color:rgb(69, 69, 69);">getOutputType</font>

<font style="color:rgb(69, 69, 69);">getOutputType æ–¹æ³•ä¸­è¿”å› udf è¾“å‡ºç»“æœçš„ schemaï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬çš„è¾“å‡ºç»“æœæ˜¯ç‚¹ï¼Œç‚¹æœ‰ meta å­—æ®µ id å’Œå±æ€§å­—æ®µ componentã€‚</font>

```plain
public StructType getOutputType() {
    return new StructType(
        new TableField("id", LongType.INSTANCE, false),
        new TableField(keyFieldName, StringType.INSTANCE, false)
    );
}
```

## <font style="color:rgb(69, 69, 69);">æ€»ç»“</font>

<font style="color:rgb(69, 69, 69);">åœ¨æœ¬ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•åœ¨ TuGraph Analytics ä¸Šå®ç°å¼±è”é€šåˆ†é‡ç®—æ³•ï¼Œå¦‚æœä½ è§‰å¾—æ¯”è¾ƒæœ‰è¶£ï¼Œæ¬¢è¿å…³æ³¨æˆ‘ä»¬çš„ç¤¾åŒº</font><font style="color:rgb(69, 69, 69);"> </font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)<font style="color:rgb(69, 69, 69);"> </font><font style="color:rgb(69, 69, 69);">ã€‚å¼€æºä¸æ˜“ï¼Œå¦‚æœä½ è§‰å¾—è¿˜ä¸é”™ï¼Œå¯ä»¥ç»™æˆ‘ä»¬ star æ”¯æŒä¸€ä¸‹</font>

---

<font style="color:rgb(69, 69, 69);">GeaFlow(å“ç‰Œå TuGraph-Analytics) å·²æ­£å¼å¼€æºï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ï¼ï¼ï¼</font>

<font style="color:rgb(69, 69, 69);">æ¬¢è¿ç»™æˆ‘ä»¬ Star å“¦!</font>

<font style="color:rgb(69, 69, 69);">Welcome to give us a Star!</font>

<font style="color:rgb(69, 69, 69);">GitHub</font><font style="color:rgb(69, 69, 69);">ğŸ‘‰</font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)

#### <font style="color:rgb(69, 69, 69);">å¾®ä¿¡ç¾¤</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/96961/1755590820839-32a0da91-82f2-43d8-af0e-1046f171431e.png)

<font style="color:rgb(69, 69, 69);">è¯·ç‚¹å‡»é¡¹ç›®é“¾æ¥ä¸‹æ–¹å¾®ä¿¡äºŒç»´ç æ·»åŠ å¾®ä¿¡ç”¨æˆ·ç¾¤ï¼š</font>[<font style="color:rgb(255, 81, 0);">https://github.com/TuGraph-family/tugraph-analytics</font>](https://github.com/TuGraph-family/tugraph-analytics)
