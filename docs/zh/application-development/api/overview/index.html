<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper plugin-docs plugin-id-zh-current docs-version-current docs-doc-page docs-doc-id-application-development/api/overview" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">简介 | GeaFlow</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kaiming-l.github.io/geaflow-website/docs/zh/application-development/api/overview"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="en-US"><meta data-rh="true" name="docsearch:language" content="en-US"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-zh-current-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-zh-current-current"><meta data-rh="true" property="og:title" content="简介 | GeaFlow"><meta data-rh="true" name="description" content="GeaFlow API是对高阶用户提供的开发接口，其支持Graph API和Stream API两种类型："><meta data-rh="true" property="og:description" content="GeaFlow API是对高阶用户提供的开发接口，其支持Graph API和Stream API两种类型："><link data-rh="true" rel="icon" href="/geaflow-website/img/favicon.png"><link data-rh="true" rel="canonical" href="https://kaiming-l.github.io/geaflow-website/docs/zh/application-development/api/overview"><link data-rh="true" rel="alternate" href="https://kaiming-l.github.io/geaflow-website/docs/zh/application-development/api/overview" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://kaiming-l.github.io/geaflow-website/zh-CN/docs/zh/application-development/api/overview" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://kaiming-l.github.io/geaflow-website/docs/zh/application-development/api/overview" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://HO4M21RAQI-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"简介","item":"https://kaiming-l.github.io/geaflow-website/docs/zh/application-development/api/overview"}]}</script><link rel="alternate" type="application/rss+xml" href="/geaflow-website/blog/rss.xml" title="GeaFlow RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/geaflow-website/blog/atom.xml" title="GeaFlow Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="GeaFlow" href="/geaflow-website/opensearch.xml">





<meta name="algolia-site-verification" content="4AB782AC2021573E">
<meta property="og:image" content="https://mdn.alipayobjects.com/huamei_tu4rvn/afts/img/A*PkdvSLd2A6kAAAAAQMAAAAgAep_eAQ/original"><link rel="stylesheet" href="/geaflow-website/assets/css/styles.b78ac409.css">
<script src="/geaflow-website/assets/js/runtime~main.5eef9370.js" defer="defer"></script>
<script src="/geaflow-website/assets/js/main.9dd247bd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/geaflow-website/img/logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/geaflow-website/"><div class="navbar__logo"><img src="/geaflow-website/img/logo.png" alt="GeaFlow Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/geaflow-website/img/logo.png" alt="GeaFlow Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="versionSelect_qA4O"><div class="versions_jk5T"><div class="selectItem_V7J8 selectItemActive_BNvF">0.0.2</div><div class="selectItem_V7J8">0.0.1</div></div><div class="current_ORt9">0.0.2</div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link header-locale-dropdown"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/geaflow-website/docs/zh/application-development/api/overview" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">English</a></li><li><a href="/geaflow-website/zh-CN/docs/zh/application-development/api/overview" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">简体中文</a></li></ul></div><a href="https://github.com/apache/geaflow" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_dCNk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="navbarCenter_ZzI1"> <a aria-current="page" class="navbar__item navbar__link navbar__link--active" id="docs" href="/geaflow-website/docs/guide">Docs</a><a class="navbar__item navbar__link" id="community" href="/geaflow-website/community/how_to_contribute">Community</a><a class="navbar__item navbar__link" href="/geaflow-website/download">Download</a><a class="navbar__item navbar__link" href="/geaflow-website/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li><li><a href="https://www.apache.org/foundation/policies/conduct.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Code of Conduct</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/geaflow-website/docs/zh/guide">文档地图</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/geaflow-website/docs/zh/introduction">产品简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/geaflow-website/docs/zh/quick_start/quick_start">快速开始</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/geaflow-website/docs/zh/concepts/glossary">技术原理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/geaflow-website/docs/zh/application-development/api/overview">开发指南</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/geaflow-website/docs/zh/application-development/api/overview">API开发</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/geaflow-website/docs/zh/application-development/api/overview">简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/geaflow-website/docs/zh/application-development/api/stream/source">流API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/geaflow-website/docs/zh/application-development/api/graph/traversal">图API</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/geaflow-website/docs/zh/application-development/dsl/overview">DSL开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/geaflow-website/docs/zh/application-development/connector/common">连接器(Connector)</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/geaflow-website/docs/zh/application-development/chat_guide">Text2GQL语法提示手册</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/geaflow-website/docs/zh/deploy/install_guide">部署</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/geaflow-website/docs/zh/contribution">参与贡献</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/geaflow-website/docs/zh/contacts">联系我们</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/geaflow-website/docs/zh/thanks">致谢</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/geaflow-website/docs/zh/reference/vs_join">参考资料</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/geaflow-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">开发指南</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">API开发</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">简介</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>简介</h1></header>
<p>GeaFlow API是对高阶用户提供的开发接口，其支持Graph API和Stream API两种类型：</p>
<ul>
<li>Graph API：Graph是GeaFlow框架的一等公民，当前GeaFlow框架提供了一套基于GraphView的图计算编程接口，包含图构建、图计算及遍历。在GeaFlow中支持Static Graph和Dynamic Graph两种类型。
<ul>
<li>Static Graph API：静态图计算API，基于该类API可以进行全量的图计算或图遍历。</li>
<li>Dynamic Graph API：动态图计算API，GeaFlow中GraphView是动态图的数据抽象，基于GraphView之上，可以进行动态图计算或图遍历。同时支持对Graphview生成Snapshot快照，基于Snapshot可以提供和Static Graph API一样的接口能力。
<img decoding="async" loading="lazy" alt="api_arch" src="/geaflow-website/assets/images/api_arch-34c1a2451d59849a53fc3e04e0ddfec4.jpeg" width="630" height="331" class="img_ev3q"></li>
</ul>
</li>
<li>Stream API：GeaFlow提供了一套通用计算的编程接口，包括source构建、流批计算及sink输出。在GeaFlow中支持Batch和Stream两种类型。
<ul>
<li>Batch API：批计算API，基于该类API可以进行批量计算。</li>
<li>Stream API：流计算API，GeaFlow中StreamView是动态流的数据抽象，基于StreamView之上，可以进行流计算。</li>
</ul>
</li>
</ul>
<p>通过两种类型API的介绍可以看到，GeaFlow内部通过View统一了图视图和流视图语义。同时为了统一支持动态和静态计算两套API，GeaFlow内部抽象了Window的概念，即从Source API开始就必须带有Window，用以基于Window的方式切分数据窗口。</p>
<ul>
<li>对于流或动态图API来说，Window可以按照size来切分，每个窗口读取一定size的数据，从而实现流式增量的计算。</li>
<li>对于批或静态图API来说，Window将采用AllWindow模式，一个窗口将读取全量数据，从而实现全量的计算。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="maven依赖">Maven依赖<a href="#maven依赖" class="hash-link" aria-label="Direct link to Maven依赖" title="Direct link to Maven依赖">​</a></h2>
<p>开发GeaFlow API应用需要添加一下maven依赖：</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">com.antgroup.tugraph</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">geaflow-api</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">0.1</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">com.antgroup.tugraph</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">geaflow-pdata</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">0.1</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">com.antgroup.tugraph</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">geaflow-cluster</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">0.1</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">com.antgroup.tugraph</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">geaflow-on-local</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">0.1</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">com.antgroup.tugraph</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">groupId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">geaflow-pipeline</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">artifactId</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">0.1</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">version</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">dependency</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="功能概览">功能概览<a href="#功能概览" class="hash-link" aria-label="Direct link to 功能概览" title="Direct link to 功能概览">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graph-api">Graph API<a href="#graph-api" class="hash-link" aria-label="Direct link to Graph API" title="Direct link to Graph API">​</a></h3>
<p>Graph API是GeaFlow中的一等公民，其提供了一套基于GraphView的图计算编程接口，包含图构建、图计算及遍历。具体的API说明如下表格所示：</p>
<table>
	<tbody><tr>
		<td>类型</td>
		<td>API</td>
		<td>说明</td>
	</tr>
	<tr>
		<td rowspan="7">动态图</td>
		<td>PGraphView init(GraphViewDesc graphViewDesc)</td>
		<td>传入graphViewDesc进行初始化</td>
	</tr>
	<tr>
		<td>PGraphView PIncGraphView appendVertex(PWindowStream vertexStream)     </td>
		<td>将分布式vertex流作为graphview增量的图点集</td>
	</tr>
	<tr>
		<td>PIncGraphView appendEdge(PWindowStream edgeStream)     </td>
		<td>将分布式edge流作为graphview增量的图边集</td>
	</tr>
	<tr>
		<td>PIncGraphView appendGraph(PWindowStream vertexStream, PWindowStream edgeStream)     </td>
		<td>将分布式vertex、edge流作为graphview增量的图点/边集</td>
	</tr>
	<tr>
		<td> PGraphTraversal incrementalTraversal(IncVertexCentricTraversal incVertexCentricTraversal)     </td>
		<td>在动态graphview上进行增量图遍历</td>
	</tr>
	<tr>
		<td>PGraphCompute incrementalCompute(IncVertexCentricCompute incVertexCentricCompute)     </td>
		<td>在动态graphview上进行增量图计算 </td>
	</tr>
	<tr>
		<td>void materialize()     </td>
		<td>将动态graphview中增量的点边集合物化存储到state中 </td>
	</tr>
	<tr>
		<td rowspan="7">静态图</td>
		<td> PGraphCompute compute(VertexCentricCompute vertexCentricCompute)</td>
		<td>在Graph上进行静态图VC计算</td>
	</tr>
	<tr>
		<td> PGraphWindow compute(ScatterGatherCompute sgAlgorithm, int parallelism)     </td>
		<td>在Graph上进行静态图SG计算</td>
	</tr>
	<tr>
		<td> PGraphTraversal traversal(VertexCentricTraversal vertexCentricTraversal)     </td>
		<td>在Graph上进行静态图VC遍历</td>
	</tr>
	<tr>
		<td> PWindowStream getEdges()     </td>
		<td>返回edge集合</td>
	</tr>
	<tr>
		<td>PWindowStream getVertices()     </td>
		<td>返回vertex集合 </td>
	</tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="stream-api">Stream API<a href="#stream-api" class="hash-link" aria-label="Direct link to Stream API" title="Direct link to Stream API">​</a></h3>
<p>Stream API提供了一套通用计算的编程接口，包括source构建、流批计算及sink输出。具体的API说明如下表格所示：</p>
<table>
	<tbody><tr>
		<td>类型</td>
		<td>API</td>
		<td>说明</td>
	</tr>
	<tr>
		<td rowspan="4">流</td>
		<td>PStreamView init(IViewDesc viewDesc)</td>
		<td>传入StreamViewDesc进行初始化</td>
	</tr>
	<tr>
		<td>PIncStreamView append(PWindowStream windowStream)     </td>
		<td>将分布式数据作为streamView增量的数据集</td>
	</tr>
	<tr>
		<td>PWindowStream reduce(ReduceFunction reduceFunction)     </td>
		<td>在动态streamView上进行增量reduce聚合计算</td>
	</tr>
	<tr>
		<td> PWindowStream aggregate(AggregateFunction aggregateFunction)     </td>
		<td>在动态streamView上进行增量aggregate聚合计算</td>
	</tr>
	<tr>
		<td rowspan="12">批</td>
		<td>PStreamView  PWindowStream map(MapFunction mapFunction)</td>
		<td>进行map操作</td>
	</tr>
	<tr>
		<td>PWindowStream filter(FilterFunction filterFunction)     </td>
		<td>进行filter操作</td>
	</tr>
	<tr>
		<td> PWindowStream flatMap(FlatMapFunction flatMapFunction)      </td>
		<td>进行flatmap操作</td>
	</tr>
	<tr>
		<td> PWindowStream union(PStream uStream)     </td>
		<td>将两个流进行union合并</td>
	</tr>
	<tr>
		<td>PWindowBroadcastStream broadcast()     </td>
		<td>将流广播到下游</td>
	</tr>
	<tr>
		<td> PWindowKeyStream keyBy(KeySelector selectorFunction)     </td>
		<td>按照selectorFunction规则进行keyby</td>
	</tr>
	<tr>
		<td>PStreamSink sink(SinkFunction sinkFunction)     </td>
		<td>将结果输出</td>
	</tr>
	<tr>
		<td>PWindowCollect collect()     </td>
		<td>触发数据结果的收集</td>
	</tr>
	<tr>
		<td>PWindowStream reduce(ReduceFunction reduceFunction)     </td>
		<td>进行一个window内的reduce聚合计算</td>
	</tr>
	<tr>
		<td> PWindowStream aggregate(AggregateFunction aggregateFunction)     </td>
		<td>进行一个window内的aggregate聚合计算</td>
	</tr>
	<tr>
		<td> PIncStreamView materialize()     </td>
		<td>将PWindowKeyStream作为动态streamView，默认keyby后生成IncstreamView</td>
	</tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="典型示例">典型示例<a href="#典型示例" class="hash-link" aria-label="Direct link to 典型示例" title="Direct link to 典型示例">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pagerank动态图计算示例介绍">PageRank动态图计算示例介绍<a href="#pagerank动态图计算示例介绍" class="hash-link" aria-label="Direct link to PageRank动态图计算示例介绍" title="Direct link to PageRank动态图计算示例介绍">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pagerank的定义">PageRank的定义<a href="#pagerank的定义" class="hash-link" aria-label="Direct link to PageRank的定义" title="Direct link to PageRank的定义">​</a></h4>
<p>PageRank算法最初作为互联网网页重要度的计算方法，1996年由Page和Brin提出，并用于谷歌搜索引擎的网页排序。事实上，PageRank 可以定义在任意有向图上，后来被应用到社会影响力分析、文本摘要等多个问题。
假设互联网是一个有向图，在其基础上定义随机游走模型，即一阶马尔可夫链，表示网页浏览者在互联网上随机浏览网页的过程。假设浏览者在每个网页依照连接出去的超链接以等概率跳转到下一个网页，并在网上持续不断进行这样的随机跳转，这个过程形成一阶马尔可夫链。PageRank表示这个马尔可夫链的平稳分布。每个网页的PageRank值就是平稳概率。
算法实现思路：1.假设图中每个点的初始影响值相同；2.计算每个点对其他点的跳转概率，并更新点的影响值；3.进行n次迭代计算，直到各点影响值不再变化，即收敛状态。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="实例代码">实例代码<a href="#实例代码" class="hash-link" aria-label="Direct link to 实例代码" title="Direct link to 实例代码">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class IncrGraphCompute {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private static final Logger LOGGER = LoggerFactory.getLogger(IncrGraphCompute.class);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	// 计算结果路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final String RESULT_FILE_PATH = &quot;./target/tmp/data/result/incr_graph&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	// 结果对比路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final String REF_FILE_PATH = &quot;data/reference/incr_graph&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 获取执行环境</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Environment environment = EnvironmentFactory.onLocalEnvironment();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 执行作业提交</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IPipelineResult result = submit(environment);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 等待执行完成</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        result.get();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 关闭执行环境</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		environment.shutdown();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static IPipelineResult&lt;?&gt; submit(Environment environment) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 构建任务执行流</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        final Pipeline pipeline = PipelineFactory.buildPipeline(environment);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 获取作业环境配置</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Configuration envConfig = environment.getEnvironmentContext().getConfig();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 指定保存计算结果的路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        envConfig.put(FileSink.OUTPUT_DIR, RESULT_FILE_PATH);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // graphview 名称</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        final String graphName = &quot;graph_view_name&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 创建增量图 graphview</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        GraphViewDesc graphViewDesc = GraphViewBuilder</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			.createGraphView(graphName)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 设置 graphview 分片数, 可从配置中指定</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .withShardNum(envConfig.getInteger(ExampleConfigKeys.ITERATOR_PARALLELISM))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 设置 graphview backend 类型</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .withBackend(BackendType.RocksDB)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 指定 graphview 点边以及属性等schema信息</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .withSchema(new GraphMetaType(IntegerType.INSTANCE, ValueVertex.class, Integer.class, ValueEdge.class, IntegerType.class))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .build();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 将创建好的graphview信息添加到任务执行流</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pipeline.withView(graphName, graphViewDesc);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 提交任务并执行</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pipeline.submit(new PipelineTask() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            public void execute(IPipelineTaskContext pipelineTaskCxt) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                Configuration conf = pipelineTaskCxt.getConfig();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 1. 构建点数据输入源</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                PWindowSource&lt;IVertex&lt;Integer, Integer&gt;&gt; vertices =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    // extract vertex from edge file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    pipelineTaskCxt.buildSource(new RecoverableFileSource&lt;&gt;(&quot;data/input/email_edge&quot;,			</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						// 指定每行数据的解析格式</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        line -&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            String[] fields = line.split(&quot;,&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            IVertex&lt;Integer, Integer&gt; vertex1 = new ValueVertex&lt;&gt;(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                Integer.valueOf(fields[0]), 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            IVertex&lt;Integer, Integer&gt; vertex2 = new ValueVertex&lt;&gt;(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                Integer.valueOf(fields[1]), 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            return Arrays.asList(vertex1, vertex2);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        }), SizeTumblingWindow.of(10000))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						// 指定点数据source并发数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        .withParallelism(pipelineTaskCxt.getConfig().getInteger(ExampleConfigKeys.SOURCE_PARALLELISM));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 2. 构建边数据输入源</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                PWindowSource&lt;IEdge&lt;Integer, Integer&gt;&gt; edges =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    pipelineTaskCxt.buildSource( new RecoverableFileSource&lt;&gt;(&quot;data/input/email_edge&quot;,			</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						// 指定每行数据的解析格式</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        line -&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            String[] fields = line.split(&quot;,&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            IEdge&lt;Integer, Integer&gt; edge = new ValueEdge&lt;&gt;(Integer.valueOf(fields[0]),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                Integer.valueOf(fields[1]), 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            return Collections.singletonList(edge);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        }), SizeTumblingWindow.of(5000))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						// 指定边数据source并发数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						.withParallelism(pipelineTaskCxt.getConfig().getInteger(ExampleConfigKeys.SOURCE_PARALLELISM));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 获取定义的graphview, 并构建图数据</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                PGraphView&lt;Integer, Integer, Integer&gt; fundGraphView =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    pipelineTaskCxt.getGraphView(graphName);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                PIncGraphView&lt;Integer, Integer, Integer&gt; incGraphView =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    fundGraphView.appendGraph(vertices, edges);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 获取作业执行map算子的并发数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                int mapParallelism = pipelineTaskCxt.getConfig().getInteger(ExampleConfigKeys.MAP_PARALLELISM);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 获取作业执行sink算子的并发数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                int sinkParallelism = pipelineTaskCxt.getConfig().getInteger(ExampleConfigKeys.SINK_PARALLELISM);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 创建sink方法</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                SinkFunction&lt;String&gt; sink = ExampleSinkFunctionFactory.getSinkFunction(conf);			</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 基于图算法，执行动态图计算</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                incGraphView.incrementalCompute(new IncGraphAlgorithms(3))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					// 获取结果点数据并作map操作</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .getVertices()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .map(v -&gt; String.format(&quot;%s,%s&quot;, v.getId(), v.getValue()))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .withParallelism(mapParallelism)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .sink(sink)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .withParallelism(sinkParallelism);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return pipeline.execute();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	// 创建Pagerank动态图算法</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static class IncGraphAlgorithms extends IncVertexCentricCompute&lt;Integer, Integer,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Integer, Integer&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public IncGraphAlgorithms(long iterations) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 设置算法最大迭代次数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            super(iterations);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public IncVertexCentricComputeFunction&lt;Integer, Integer, Integer, Integer&gt; getIncComputeFunction() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 指定Pagerank计算逻辑</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return new PRVertexCentricComputeFunction();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public VertexCentricCombineFunction&lt;Integer&gt; getCombineFunction() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static class PRVertexCentricComputeFunction implements</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IncVertexCentricComputeFunction&lt;Integer, Integer, Integer, Integer&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        private IncGraphComputeContext&lt;Integer, Integer, Integer, Integer&gt; graphContext;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// init方法, 获取graphContext</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public void init(IncGraphComputeContext&lt;Integer, Integer, Integer, Integer&gt; graphContext) {	</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            this.graphContext = graphContext;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 第一轮迭代evolve方法实现</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public void evolve(Integer vertexId,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                           TemporaryGraph&lt;Integer, Integer, Integer&gt; temporaryGraph) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 动态图版本指定为0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            long lastVersionId = 0L;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 从增量图中获取id等于 vertexId 的点</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            IVertex&lt;Integer, Integer&gt; vertex = temporaryGraph.getVertex();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 获取历史底图</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            HistoricalGraph&lt;Integer, Integer, Integer&gt; historicalGraph = graphContext</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .getHistoricalGraph();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (vertex == null) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 如果增量图中不存在id 等于 vertexId 的点, 就从历史图中获取</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                vertex = historicalGraph.getSnapShot(lastVersionId).vertex().get();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (vertex != null) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 从增量图中获取点对应的所有出边</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                List&lt;IEdge&lt;Integer, Integer&gt;&gt; newEs = temporaryGraph.getEdges();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 从历史图中获取点对应的所有出边</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                List&lt;IEdge&lt;Integer, Integer&gt;&gt; oldEs = historicalGraph.getSnapShot(lastVersionId)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .edges().getOutEdges();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                if (newEs != null) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    for (IEdge&lt;Integer, Integer&gt; edge : newEs) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						// 向增量图中所有边的终点，发送消息，内容为vertexId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        graphContext.sendMessage(edge.getTargetId(), vertexId);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                if (oldEs != null) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    for (IEdge&lt;Integer, Integer&gt; edge : oldEs) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						// 向历史图中所有边的终点，发送消息，内容为vertexId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        graphContext.sendMessage(edge.getTargetId(), vertexId);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public void compute(Integer vertexId, Iterator&lt;Integer&gt; messageIterator) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            int max = 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 迭代vertexId收到的所有消息, 并取其中的最大值</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            while (messageIterator.hasNext()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                int value = messageIterator.next();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                max = max &gt; value ? max : value;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 从增量图中获取id 等于vertexId的点</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            IVertex&lt;Integer, Integer&gt; vertex = graphContext.getTemporaryGraph().getVertex();		</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 从历史图中获取id等于 vertexId 的点</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            IVertex&lt;Integer, Integer&gt; historyVertex = graphContext.getHistoricalGraph().getSnapShot(0).vertex().get();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 将增量图中的点属性值和消息的最大值，两者取最大</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (vertex != null &amp;&amp; max &lt; vertex.getValue()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                max = vertex.getValue();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 将历史图中的点属性值和消息的最大值，两者取最大</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (historyVertex != null &amp;&amp; max &lt; historyVertex.getValue()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                max = historyVertex.getValue();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 更新增量图中点的属性值</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            graphContext.getTemporaryGraph().updateVertexValue(max);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public void finish(Integer vertexId, MutableGraph&lt;Integer, Integer, Integer&gt; mutableGraph) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 从增量图中获取vertexId相关的点边</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            IVertex&lt;Integer, Integer&gt; vertex = graphContext.getTemporaryGraph().getVertex();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            List&lt;IEdge&lt;Integer, Integer&gt;&gt; edges = graphContext.getTemporaryGraph().getEdges();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (vertex != null) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 将增量图中的点添加到图数据中。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                mutableGraph.addVertex(0, vertex);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                graphContext.collect(vertex);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                LOGGER.info(&quot;not found vertex {} in temporaryGraph &quot;, vertexId);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (edges != null) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 将增量中的边添加到图数据中。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                edges.stream().forEach(edge -&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    mutableGraph.addEdge(0, edge);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pagerank静态图计算示例介绍">PageRank静态图计算示例介绍<a href="#pagerank静态图计算示例介绍" class="hash-link" aria-label="Direct link to PageRank静态图计算示例介绍" title="Direct link to PageRank静态图计算示例介绍">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="实例代码-1">实例代码<a href="#实例代码-1" class="hash-link" aria-label="Direct link to 实例代码" title="Direct link to 实例代码">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class PageRank {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private static final Logger LOGGER = LoggerFactory.getLogger(PageRank.class);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	// 计算结果路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final String RESULT_FILE_PATH = &quot;./target/tmp/data/result/pagerank&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	// 结果对比路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final String REF_FILE_PATH = &quot;data/reference/pagerank&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 获取作业执行环境</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Environment environment = EnvironmentFactory.onLocalEnvironment();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 执行作业提交</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IPipelineResult&lt;?&gt; result = submit(environment);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        result.get();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 关闭执行环境</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        environment.shutdown();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static IPipelineResult&lt;?&gt; submit(Environment environment) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 构建任务执行流</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Pipeline pipeline = PipelineFactory.buildPipeline(environment);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 获取作业相关配置</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Configuration envConfig = environment.getEnvironmentContext().getConfig();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 指定结果输出路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        envConfig.put(FileSink.OUTPUT_DIR, RESULT_FILE_PATH);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 提交任务并执行</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pipeline.submit((PipelineTask) pipelineTaskCxt -&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Configuration conf = pipelineTaskCxt.getConfig();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 1. 构建图中点的输入数据</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            PWindowSource&lt;IVertex&lt;Integer, Double&gt;&gt; prVertices =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                pipelineTaskCxt.buildSource(new FileSource&lt;&gt;(&quot;data/input/email_vertex&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					// 定义每行数据解析成点的格式</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    line -&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        String[] fields = line.split(&quot;,&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        IVertex&lt;Integer, Double&gt; vertex = new ValueVertex&lt;&gt;(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            Integer.valueOf(fields[0]), Double.valueOf(fields[1]));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        return Collections.singletonList(vertex);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }), AllWindow.getInstance())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					// 设定并发数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .withParallelism(conf.getInteger(ExampleConfigKeys.SOURCE_PARALLELISM));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 2. 构建图中边的输入数据</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            PWindowSource&lt;IEdge&lt;Integer, Integer&gt;&gt; prEdges = pipelineTaskCxt.buildSource(new FileSource&lt;&gt;(&quot;data/input/email_edge&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 定义每行数据解析成边的格式</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                line -&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    String[] fields = line.split(&quot;,&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    IEdge&lt;Integer, Integer&gt; edge = new ValueEdge&lt;&gt;(Integer.valueOf(fields[0]), Integer.valueOf(fields[1]), 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    return Collections.singletonList(edge);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }), AllWindow.getInstance())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 设定并发数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .withParallelism(conf.getInteger(ExampleConfigKeys.SOURCE_PARALLELISM));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 迭代计算并发数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            int iterationParallelism = conf.getInteger(ExampleConfigKeys.ITERATOR_PARALLELISM);		</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 定义graphview</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            GraphViewDesc graphViewDesc = GraphViewBuilder</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .createGraphView(GraphViewBuilder.DEFAULT_GRAPH)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 指定分片数为2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .withShardNum(2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 指定backend类型为memory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .withBackend(BackendType.Memory)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 基于点边数据和定义的graphview, 构建静态图</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            PGraphWindow&lt;Integer, Double, Integer&gt; graphWindow =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                pipelineTaskCxt.buildWindowStreamGraph(prVertices, prEdges, graphViewDesc);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 获取sink函数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            SinkFunction&lt;IVertex&lt;Integer, Double&gt;&gt; sink = ExampleSinkFunctionFactory.getSinkFunction(conf);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 指定计算并发数，执行静态计算方法</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            graphWindow.compute(new PRAlgorithms(3))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .compute(iterationParallelism)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 获取计算结果点，按照定义的sink函数输出</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .getVertices()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .sink(sink)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .withParallelism(conf.getInteger(ExampleConfigKeys.SINK_PARALLELISM));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return pipeline.execute();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static void validateResult() throws IOException {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ResultValidator.validateResult(REF_FILE_PATH, RESULT_FILE_PATH);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static class PRAlgorithms extends VertexCentricCompute&lt;Integer, Double, Integer, Double&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public PRAlgorithms(long iterations) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 指定静态图计算的迭代次数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            super(iterations);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public VertexCentricComputeFunction&lt;Integer, Double, Integer, Double&gt; getComputeFunction() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return new PRVertexCentricComputeFunction();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public VertexCentricCombineFunction&lt;Double&gt; getCombineFunction() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static class PRVertexCentricComputeFunction extends AbstractVcFunc&lt;Integer, Double, Integer, Double&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 静态图计算方法实现</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public void compute(Integer vertexId,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            Iterator&lt;Double&gt; messageIterator) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			// 从静态图中获取点id等于vertexId的点</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            IVertex&lt;Integer, Double&gt; vertex = this.context.vertex().get();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (this.context.getIterationId() == 1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 第一轮迭代向邻居节点发送消息，消息内容为vertexId点的属性值</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                this.context.sendMessageToNeighbors(vertex.getValue());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                double sum = 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                while (messageIterator.hasNext()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    double value = messageIterator.next();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    sum += value;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 累积消息之和，并设置为当前点的属性值</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                this.context.setNewVertexValue(sum);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="wordcount批计算示例介绍">WordCount批计算示例介绍<a href="#wordcount批计算示例介绍" class="hash-link" aria-label="Direct link to WordCount批计算示例介绍" title="Direct link to WordCount批计算示例介绍">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="实例代码-2">实例代码<a href="#实例代码-2" class="hash-link" aria-label="Direct link to 实例代码" title="Direct link to 实例代码">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class WordCountStream {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private static final Logger LOGGER = LoggerFactory.getLogger(WordCountStream.class);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	// 计算结果路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final String RESULT_FILE_PATH = &quot;./target/tmp/data/result/wordcount&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	// 结果对比路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final String REF_FILE_PATH = &quot;data/reference/wordcount&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 获取作业执行环境</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Environment environment = EnvironmentUtil.loadEnvironment(args);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 执行作业提交</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IPipelineResult&lt;?&gt; result = submit(environment);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        result.get();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 关闭执行环境</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        environment.shutdown();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static IPipelineResult&lt;?&gt; submit(Environment environment) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 构建任务执行流</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Pipeline pipeline = PipelineFactory.buildPipeline(environment);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 获取作业环境配置</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Configuration envConfig = environment.getEnvironmentContext().getConfig();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// 指定保存计算结果的路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        envConfig.getConfigMap().put(FileSink.OUTPUT_DIR, RESULT_FILE_PATH);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pipeline.submit(new PipelineTask() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            public void execute(IPipelineTaskContext pipelineTaskCxt) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                Configuration conf = pipelineTaskCxt.getConfig();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">				// 获取输入数据流</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                PWindowSource&lt;String&gt; streamSource = pipelineTaskCxt.buildSource(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    new FileSource&lt;String&gt;(&quot;data/input/email_edge&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">						// 定义每行数据的解析格式</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        line -&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            String[] fields = line.split(&quot;,&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            return Collections.singletonList(fields[0]);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">								// 定义数据窗口大小</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        }) {}, SizeTumblingWindow.of(5000))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					// 定义输入数据流的并发数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .withParallelism(conf.getInteger(ExampleConfigKeys.SOURCE_PARALLELISM));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                SinkFunction&lt;String&gt; sink = ExampleSinkFunctionFactory.getSinkFunction(conf);			</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                streamSource</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					// 对流中的数据作map操作</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .map(e -&gt; Tuple.of(e, 1))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					// key by</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .keyBy(new KeySelectorFunc())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					// reduce 聚合统计相同数据的个数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .reduce(new CountFunc())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">					// 指定算子并发数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .withParallelism(conf.getInteger(ExampleConfigKeys.REDUCE_PARALLELISM))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .map(v -&gt; String.format(&quot;(%s,%s)&quot;, ((Tuple) v).f0, ((Tuple) v).f1))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .sink(sink)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .withParallelism(conf.getInteger(ExampleConfigKeys.SINK_PARALLELISM));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return pipeline.execute();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static void validateResult() throws IOException {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ResultValidator.validateResult(REF_FILE_PATH, RESULT_FILE_PATH);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static class MapFunc implements MapFunction&lt;String, Tuple&lt;String, Integer&gt;&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		// map方法实现, 将每个输入单词转换为Tuple</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public Tuple&lt;String, Integer&gt; map(String value) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            LOGGER.info(&quot;MapFunc process value: {}&quot;, value);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return Tuple.of(value, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static class KeySelectorFunc implements KeySelector&lt;Tuple&lt;String, Integer&gt;, Object&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public Object getKey(Tuple&lt;String, Integer&gt; value) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return value.f0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static class CountFunc implements ReduceFunction&lt;Tuple&lt;String, Integer&gt;&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public Tuple&lt;String, Integer&gt; reduce(Tuple&lt;String, Integer&gt; oldValue, Tuple&lt;String, Integer&gt; newValue) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return Tuple.of(oldValue.f0, oldValue.f1 + newValue.f1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="keyagg流计算示例介绍">KeyAgg流计算示例介绍<a href="#keyagg流计算示例介绍" class="hash-link" aria-label="Direct link to KeyAgg流计算示例介绍" title="Direct link to KeyAgg流计算示例介绍">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="实例代码-3">实例代码<a href="#实例代码-3" class="hash-link" aria-label="Direct link to 实例代码" title="Direct link to 实例代码">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class WindowStreamKeyAgg implements Serializable {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private static final Logger LOGGER = LoggerFactory.getLogger(WindowStreamKeyAgg.class);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // 计算结果路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final String RESULT_FILE_PATH = &quot;./target/tmp/data/result/wordcount&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // 结果对比路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final String REF_FILE_PATH = &quot;data/reference/wordcount&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // 获取作业执行环境</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Environment environment = EnvironmentUtil.loadEnvironment(args);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // 执行作业提交</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IPipelineResult&lt;?&gt; result = submit(environment);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        result.get();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // 关闭执行环境</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        environment.shutdown();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static IPipelineResult&lt;?&gt; submit(Environment environment) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // 构建执行流</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Pipeline pipeline = PipelineFactory.buildPipeline(environment);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // 获取作业环境配置</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Configuration envConfig = environment.getEnvironmentContext().getConfig();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // 指定作业结果输出路径</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        envConfig.getConfigMap().put(FileSink.OUTPUT_DIR, RESULT_FILE_PATH);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // 开启动态流图materialize开关</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        envConfig.getConfigMap().put(FrameworkConfigKeys.INC_STREAM_MATERIALIZE_DISABLE.getKey(), Boolean.TRUE.toString());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ResultValidator.cleanResult(RESULT_FILE_PATH);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pipeline.submit(new PipelineTask() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            public void execute(IPipelineTaskContext pipelineTaskCxt) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                Configuration conf = pipelineTaskCxt.getConfig();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                // 窗口大小定义为5000, 构建输入数据流</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                PWindowSource&lt;String&gt; streamSource =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    pipelineTaskCxt.buildSource(new FileSource&lt;String&gt;(&quot;data/input&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        + &quot;/email_edge&quot;, Collections::singletonList) {}, SizeTumblingWindow.of(5000));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                SinkFunction&lt;String&gt; sink = ExampleSinkFunctionFactory.getSinkFunction(conf);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                streamSource</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .flatMap(new FlatMapFunction&lt;String, Long&gt;() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        public void flatMap(String value, Collector collector) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            // flatmap方法实现</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            String[] records = value.split(SPLIT);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            for (String record : records) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                // 将每行数据切分并获取</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                collector.partition(Long.valueOf(record));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    })</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    // map算子</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .map(p -&gt; Tuple.of(p, p))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    // 定义特定条件的key by算子</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .keyBy(p -&gt; ((long) ((Tuple) p).f0) % 7)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .aggregate(new AggFunc())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .withParallelism(conf.getInteger(AGG_PARALLELISM))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .map(v -&gt; String.format(&quot;%s,%s&quot;, ((Tuple) v).f0, ((Tuple) v).f1))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    .sink(sink).withParallelism(conf.getInteger(SINK_PARALLELISM));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return pipeline.execute();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static void validateResult() throws IOException {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ResultValidator.validateMapResult(REF_FILE_PATH, RESULT_FILE_PATH, String::compareTo);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static class AggFunc implements</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        AggregateFunction&lt;Tuple&lt;Long, Long&gt;, Tuple&lt;Long, Long&gt;, Tuple&lt;Long, Long&gt;&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // 定义累加器实现</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public Tuple&lt;Long, Long&gt; createAccumulator() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return Tuple.of(0L, 0L);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public void add(Tuple&lt;Long, Long&gt; value, Tuple&lt;Long, Long&gt; accumulator) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // 对相同key的两个value，累加value的f1值</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            accumulator.setF0(value.f0);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            accumulator.setF1(value.f1 + accumulator.f1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public Tuple&lt;Long, Long&gt; getResult(Tuple&lt;Long, Long&gt; accumulator) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // 返回累加后的结果</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return Tuple.of(accumulator.f0, accumulator.f1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public Tuple&lt;Long, Long&gt; merge(Tuple&lt;Long, Long&gt; a, Tuple&lt;Long, Long&gt; b) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/geaflow-website/docs/zh/concepts/console_principle"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Console平台介绍</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/geaflow-website/docs/zh/application-development/api/stream/source"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Source API介绍</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#maven依赖" class="table-of-contents__link toc-highlight">Maven依赖</a></li><li><a href="#功能概览" class="table-of-contents__link toc-highlight">功能概览</a><ul><li><a href="#graph-api" class="table-of-contents__link toc-highlight">Graph API</a></li><li><a href="#stream-api" class="table-of-contents__link toc-highlight">Stream API</a></li></ul></li><li><a href="#典型示例" class="table-of-contents__link toc-highlight">典型示例</a><ul><li><a href="#pagerank动态图计算示例介绍" class="table-of-contents__link toc-highlight">PageRank动态图计算示例介绍</a></li><li><a href="#pagerank静态图计算示例介绍" class="table-of-contents__link toc-highlight">PageRank静态图计算示例介绍</a></li><li><a href="#wordcount批计算示例介绍" class="table-of-contents__link toc-highlight">WordCount批计算示例介绍</a></li><li><a href="#keyagg流计算示例介绍" class="table-of-contents__link toc-highlight">KeyAgg流计算示例介绍</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/geaflow-website/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/geaflow-website/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>